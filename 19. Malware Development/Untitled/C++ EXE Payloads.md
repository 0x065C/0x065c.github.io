# Guide to Building a Custom Executable in Visual Studio Using C++

This guide will walk you through the process of creating a custom executable (.exe) from scratch using Visual Studio and C++. We will create a simple console application that opens a PowerShell session window when executed. Additionally, we'll include the necessary syntax and post-compile testing steps to ensure your application works as expected.

# Prerequisites

- Visual Studio: Ensure you have Visual Studio installed (Community Edition is sufficient).
- Basic Knowledge of C++: Familiarity with C++ programming.
- Administrative Rights: May be required for certain operations.

# Step 1: Setting Up the Console Application Project

1. Open Visual Studio.

2. Create a New Project:
   - Go to File > New > Project.

3. Select Project Type:
   - In the Create a new project dialog, select Visual C++ > Console App.
     - If you don't see it immediately, you can search for "Console App" in the search bar.

4. Configure Project:
   - Name: Enter a name for your project, e.g., `PowerShellLauncher`.
   - Location: Choose a location to save the project.
   - Solution Name: It can be the same as the project name.
   - Click Create.

# Step 2: Writing the Code to Open PowerShell

1. Include Necessary Headers:

   Open the automatically generated `PowerShellLauncher.cpp` file and ensure it includes the necessary headers:

   ```cpp
   #include <windows.h>
   #include <iostream>
   ```

2. Write the Code to Open PowerShell:

   Replace the contents of the `main` function with code that launches PowerShell:

   ```cpp
   int main()
   {
       // Use ShellExecute to open PowerShell
       HINSTANCE result = ShellExecute(NULL, "open", "powershell.exe", NULL, NULL, SW_SHOW);

       // Check if the operation was successful
       if ((int)result > 32)
       {
           std::cout << "PowerShell window opened successfully." << std::endl;
       }
       else
       {
           std::cerr << "Failed to open PowerShell window." << std::endl;
           // Optional: You can handle specific error codes here
       }

       return 0;
   }
   ```

   Explanation:

   - `ShellExecute`: A Windows API function used to execute an external program.
     - `NULL`: The handle to the parent window (can be `NULL` if not needed).
     - `"open"`: The operation to perform.
     - `"powershell.exe"`: The file or object to execute.
     - `NULL`: Parameters for the executable (none in this case).
     - `NULL`: Default directory (uses the current directory if `NULL`).
     - `SW_SHOW`: Shows the window.
   - The function returns a value that indicates success or failure. If the return value is greater than 32, the operation succeeded.

3. Optional: Add Error Handling:

   You can enhance the error handling to provide more information:

   ```cpp
   int main()
   {
       HINSTANCE result = ShellExecute(NULL, "open", "powershell.exe", NULL, NULL, SW_SHOW);

       if ((int)result <= 32)
       {
           // Error occurred
           switch ((int)result)
           {
           case 0:
               std::cerr << "The operating system is out of memory or resources." << std::endl;
               break;
           case ERROR_FILE_NOT_FOUND:
               std::cerr << "The specified file was not found." << std::endl;
               break;
           case ERROR_PATH_NOT_FOUND:
               std::cerr << "The specified path was not found." << std::endl;
               break;
           case ERROR_BAD_FORMAT:
               std::cerr << "The .exe file is invalid (non-Win32 .exe or error in .exe image)." << std::endl;
               break;
           default:
               std::cerr << "An unknown error occurred." << std::endl;
           }
       }
       else
       {
           std::cout << "PowerShell window opened successfully." << std::endl;
       }

       return 0;
   }
   ```

# Step 3: Building the Executable

1. Build Configuration:

   - Ensure that the build configuration is set to Release for a final build or Debug for testing.
   - Choose the appropriate Platform (Win32 or x64) depending on your system and needs.

2. Build the Project:

   - Go to Build > Build Solution or press Ctrl + Shift + B.
   - Check the Output Window for any errors or warnings.
   - The executable file (`PowerShellLauncher.exe`) will be generated in the project's `Debug` or `Release` folder, depending on your build configuration.

# Step 4: Testing the Executable

1. Locate the Executable:

   - Navigate to your project's output directory:
     - For Debug configuration: `YourProjectPath\Debug\PowerShellLauncher.exe`
     - For Release configuration: `YourProjectPath\Release\PowerShellLauncher.exe`

2. Run the Executable:

   - Double-click on `PowerShellLauncher.exe` to run it.
   - Alternatively, you can run it from the command prompt:
     - Open Command Prompt.
     - Navigate to the output directory using the `cd` command.
     - Run the executable by typing `PowerShellLauncher.exe` and pressing Enter.

3. Expected Outcome:

   - A new PowerShell window should open.
   - The console should display: `PowerShell window opened successfully.`

4. Troubleshooting:

   - Executable Doesn't Run:
     - Ensure that you are running the correct version of the executable (Debug vs. Release).
     - Verify that your system has PowerShell installed (most modern Windows systems do).
   - Error Messages:
     - If the console displays an error message, read it carefully to determine the cause.
     - Common issues include missing files or insufficient permissions.

5. Testing on Other Systems:

   - Copy the Executable:
     - You can copy the `PowerShellLauncher.exe` file to other Windows systems for testing.
   - Dependencies:
     - Since we're using standard Windows API functions, there are no additional dependencies.
     - Ensure that the target system has the necessary Visual C++ Redistributable installed if needed (usually not required for simple applications).

Note: Executing external applications like PowerShell from code should be done responsibly and securely. Always ensure that such functionalities comply with your organization's security policies and software guidelines.

Additional Tips:

- Security Considerations:

  - Be cautious when running executables that launch other programs, as this can be exploited if not handled properly.
  - Avoid hardcoding paths or using relative paths that could be manipulated.

- Error Handling:

  - Implement robust error handling to make your application more reliable and easier to debug.
  - Consider logging errors to a file for further analysis.

- User Permissions:

  - Some operations may require elevated permissions. Ensure that your application handles such scenarios gracefully.

- Enhancing Functionality:

  - You can modify the parameters passed to `powershell.exe` to run specific scripts or commands.
  - Example: To run a script named `script.ps1`, modify the `ShellExecute` call:

    ```cpp
    ShellExecute(NULL, "open", "powershell.exe", "-File \"C:\\Path\\To\\script.ps1\"", NULL, SW_SHOW);
    ```