# Index 
- [[Malware Development]]
	- [[5. Dynamic Malware Analysis Tools]]

# PEView
   Purpose: PEView is a tool used for inspecting and analyzing the structure of Portable Executable (PE) files, which are the standard executable format on Windows. PE files include `.exe`, `.dll`, `.sys`, etc.

   Key Features:
   - PE File Headers: Analyze the PE headers such as the DOS Header, NT Headers, and Section Headers.
   - Sections Analysis: View sections of the binary, such as `.text`, `.data`, `.rdata`, and `.rsrc`. You can inspect the code, data, and other resources loaded by the binary.
   - Imports/Exports: See the functions the malware imports (which libraries it uses) and exports (if it's a DLL). This can give insights into what APIs the malware is using for process manipulation, networking, etc.
   
   Use in Dynamic Analysis:
   PEView is used for pre-execution analysis to understand the structure of a malware binary before you run it. You can manually inspect how the malware is packed, its entry point, and the functions it may be calling.

   Key Malware Indicators:
   - Suspicious import libraries like `kernel32.dll`, `ntdll.dll`, or `advapi32.dll` (which may be used for process creation, memory management, or registry manipulation).
   - Abnormal section sizes or high entropy in sections, indicating packing or obfuscation.

# x64dbg / OllyDbg
   Purpose: These are debuggers used to dynamically analyze how malware behaves at runtime. Debuggers allow you to step through code instruction by instruction, inspect memory, and analyze the flow of execution.

   Key Features:
   - Instruction Tracing: Step through the execution of malware to understand how it works and identify critical functions (e.g., payload dropper routines, decryption routines).
   - Memory Breakpoints: Set breakpoints on specific memory addresses or instructions. This can be useful for halting the execution just before malicious code triggers.
   - Code Disassembly: View and interact with the assembly code of the malware.
   - Memory Inspection: Inspect and manipulate memory regions to view decoded strings or injected payloads.
   - Dumping Memory: Capture sections of memory that may contain unpacked or decrypted malicious code.

   Use in Dynamic Analysis:
   Debuggers are critical for analyzing how malware behaves in real-time. For instance, you can pause the execution when malware is attempting to unpack itself, observe the unpacking process, and dump the memory for further analysis.

   Key Malware Indicators:
   - Code that allocates memory (`VirtualAlloc`, `HeapAlloc`).
   - Functions that modify process memory (`WriteProcessMemory`, `VirtualProtect`).
   - Use of system calls that can manipulate files, processes, or network communications.

# IDA Pro / Ghidra
   Purpose: These are disassemblers that reverse-engineer binaries to help you understand the underlying assembly code. IDA Pro is a commercial product, while Ghidra is open-source (developed by the NSA).

   Key Features:
   - Static Analysis: Disassemble and decompile malware binaries, turning machine code into human-readable assembly.
   - Function Graphs: Visualize the control flow of the malware to see how it executes and which branches lead to specific behaviors (e.g., payload delivery, persistence mechanisms).
   - Code Annotations: Add comments and annotations to functions and instructions to keep track of your analysis.
   - Cross-Referencing: View where specific functions, strings, or variables are referenced in the binary.
   - Patching: Modify the binary to change its behavior, for example, to bypass anti-debugging checks.

   Use in Dynamic Analysis:
   Although these tools are generally used for static analysis, they are often combined with dynamic analysis for complex malware. For example, after dumping memory from a debugger, you can load that memory dump into IDA Pro/Ghidra for further analysis.

   Key Malware Indicators:
   - Decrypting or unpacking routines.
   - Functions responsible for network communication (`WinInet`, `WS2_32`).
   - Execution flow that shows persistence mechanisms like modifying the registry or creating scheduled tasks.

# Process Hacker
   Purpose: Process Hacker is a powerful tool for monitoring and managing system processes. It provides insights into what processes are running, their memory consumption, threads, and other resources.

   Key Features:
   - Process List: View all processes running on the system, including hidden or suspicious ones. You can easily spot new processes spawned by the malware.
   - Process Termination: Forcefully terminate processes or suspend them for analysis.
   - Injected DLLs: Detect which DLLs are loaded into each process's address space. This is useful for identifying injected malicious code.
   - Threads and Handles: Inspect threads and handles opened by processes. Malware often spawns new threads to carry out malicious actions without drawing attention.
   - Memory Inspection: View and dump process memory, which is useful for retrieving hidden or encrypted malware payloads.

   Use in Dynamic Analysis:
   Process Hacker is highly useful when analyzing malware that injects itself into legitimate processes or spawns new child processes. You can detect the presence of malicious DLLs, monitor process creation, and dump process memory for further analysis.

   Key Malware Indicators:
   - New processes created by a suspicious parent process (like `explorer.exe` spawning something unexpected).
   - DLLs injected into high-privilege processes like `winlogon.exe`.
   - Processes using excessive memory or CPU, which could indicate resource abuse by the malware.

# Procmon (Process Monitor)
   Purpose: Process Monitor (Procmon) is a real-time monitoring tool from Microsoft that allows you to track file system, registry, network, and process activity on a system.

   Key Features:
   - File Activity: Trace all file operations, such as file creation, deletion, or modification. This can help you identify where malware is trying to write to disk.
   - Registry Activity: Monitor registry modifications. Malware often modifies the registry to achieve persistence.
   - Network Activity: Track network connections, including outgoing requests to command-and-control (C2) servers.
   - Filter and Search: Set up filters to focus on specific processes or actions, such as registry modifications or file creation.
   - Event Timeline: Visualize the sequence of events to correlate actions such as a process launching, modifying a file, or writing to the registry.

   Use in Dynamic Analysis:
   Procmon is essential for tracking every action the malware takes once executed. It provides detailed insight into how malware interacts with the system and the sequence of those interactions.

   Key Malware Indicators:
   - Attempts to create or modify registry keys, especially keys related to startup (`HKCU\Software\Microsoft\Windows\CurrentVersion\Run`).
   - Unusual file creations in sensitive directories (`C:\Windows\System32` or `AppData\Roaming`).
   - Suspicious network activity (e.g., outgoing connections to IPs not typically associated with the local network).

# Process Explorer
   Purpose: Like Process Hacker, Process Explorer is a task manager replacement that provides a detailed overview of running processes, their resource consumption, and the DLLs they have loaded.

   Key Features:
   - Hierarchical Process Tree: See which process spawned another process and follow the execution chain.
   - Process Details: View detailed information about a process, such as its path, command line arguments, open handles, and loaded DLLs.
   - Memory Usage: Inspect real-time memory usage to see if any processes are consuming suspicious amounts of memory.
   - Verification: Check the digital signatures of processes to detect unsigned or malicious code.
   
   Use in Dynamic Analysis:
   Process Explorer is great for quick overviews of what processes are running and understanding the system impact of the malware.

   Key Malware Indicators:
   - Processes running from non-standard locations (e.g., running from the `Temp` directory).
   - Processes that have an invalid or missing digital signature.
   - Processes opening unexpected network connections or using high amounts of resources.

# Workflow Example for Dynamic Analysis
Hereâ€™s a typical workflow you can follow for dynamic malware analysis using the tools mentioned:

1. Initial Analysis with PEView: Inspect the PE file for anomalies, such as obfuscated sections or suspicious imports.
2. Debugging with x64dbg/OllyDbg: Run the malware in a controlled environment, step through its execution, and identify key routines such as process injection or payload delivery.
3. Monitor Behavior with Procmon: Simultaneously use Process Monitor to capture file, registry, and network events. Look for actions like file drops or registry modifications.
4. Process Inspection with Process Hacker/Explorer: Identify new processes created by the malware and inspect them for injected DLLs or malicious memory regions.
5. Further Static Analysis with IDA Pro/Ghidra: If necessary, dump memory or use a disassembler to dive deeper into critical code sections identified during dynamic analysis.

Each tool has a specific role in dynamic analysis, and using them in combination provides a comprehensive view of how malware interacts with the system.