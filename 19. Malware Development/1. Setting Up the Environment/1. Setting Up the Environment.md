# Index 
- [[Malware Development]]
	- [[1. Setting Up the Environment]]

# Setting Up the Environment for Malware Development Using C++ and Visual Studio

Before you begin developing malware or working on antivirus (AV) evasion techniques, setting up a proper environment is crucial. This step ensures you have the necessary tools, libraries, and configurations required to efficiently build and test your malware in a safe and controlled manner. Let’s dive into the setup process step by step.

# Install and Configure Visual Studio

#### Choosing the Version
- Visual Studio (VS) is one of the most widely used Integrated Development Environments (IDE) for C++ development on Windows. Microsoft offers several versions, but you should choose the Community Edition if you're just starting out. It's free and provides all the necessary features.
  - Download Visual Studio from the official site: [Visual Studio Download](https://visualstudio.microsoft.com/downloads/).

#### Installation Options
- During the installation process, select the Desktop development with C++ workload. This option will install all the libraries, compilers, and tools needed to compile and run native Windows C++ applications.
- Make sure you also select:
  - C++/CLI support if you plan to work with .NET code.
  - Windows SDK to get access to native APIs that you’ll need for deeper system interaction.
  - CMake and Ninja (optional but useful for building complex projects with dependencies).
  - Remote debugging tools if you plan to analyze malware on a separate system.

#### Configuring Your IDE for Malware Development
- Disable Code Signing (if applicable): By default, Visual Studio may attempt to sign the binaries (EXEs, DLLs) you build. However, for learning purposes, you can disable this by navigating to Project Properties → Configuration Properties → Linker → Advanced → Enable Security Checks = No.
- Disable Automatic Optimization: Some AV tools can detect optimization flags used during compilation. Set Optimization to Disabled (/Od) under Project Properties → C++ → Optimization.
- Enable Debug Symbols: For malware development, debugging will be crucial. Make sure you enable Generate Debug Information under Linker → Debugging.

# Understanding the Windows Development Environment

#### Windows Subsystem for Linux (Optional)
- If you prefer to work with Linux tools as part of your development workflow (e.g., to build cross-platform malware or leverage open-source libraries), you can install Windows Subsystem for Linux (WSL). This gives you access to a full Linux shell on Windows.
  - Enable WSL via PowerShell:
    ```bash
    wsl --install
    ```
  - You can install distributions such as Ubuntu and integrate them into your Windows environment for compiling and testing cross-platform malware.

#### Windows API Documentation
- The key to interacting with Windows systems through C++ is the Windows API (WinAPI). This is a collection of functions and system calls that allow applications to interact with the Windows OS, manipulate files, processes, memory, and more.
  - MSDN (Microsoft Developer Network): This is your primary reference for all things related to WinAPI. For example:
    - [Windows API Documentation](https://docs.microsoft.com/en-us/windows/win32/api/)
  - You’ll need to understand how to use core APIs like:
    - Memory Management: `VirtualAlloc`, `VirtualFree`, `VirtualProtect`
    - Process Management: `CreateProcess`, `OpenProcess`, `CreateRemoteThread`
    - File I/O: `CreateFile`, `ReadFile`, `WriteFile`
    - Network APIs: `WinSock` libraries for building C2 (command and control) channels.

#### Compiling 32-bit and 64-bit Binaries
- You will want to ensure that you can build both 32-bit (x86) and 64-bit (x64) binaries to target different system architectures. In Visual Studio:
  - To switch between 32-bit and 64-bit, navigate to Build → Configuration Manager, and select the appropriate target platform.
  - Test both 32-bit and 64-bit versions of your malware, as AV detection may vary between architectures.

#### Console vs. GUI Applications
- When starting, most of your malware will likely be Console Applications because they are easier to develop and debug. However, you may need to move into Windows GUI Applications as you progress, especially for more advanced techniques like creating user interfaces to mask the malware’s presence or trick users.

# Tools for Testing and Debugging Malware

#### Debugger Configuration
- The Visual Studio Debugger will be your primary tool for stepping through your malware code.
  - Set breakpoints at critical sections (e.g., process injection or file I/O) to inspect the state of memory, registers, and variables.
  - Use the Memory window in Visual Studio to directly inspect allocated memory, which will be useful when testing code that manipulates memory directly (e.g., for injecting payloads into other processes).

#### Process Explorer & Process Monitor (Sysinternals)
- Process Explorer and Process Monitor are essential tools from Sysinternals for observing how your malware interacts with the operating system.
  - Process Explorer: Helps monitor processes, memory usage, and DLL injections in real-time.
  - Process Monitor: Useful for tracking file, registry, and process activity, which is critical for understanding the behavior of your malware.
  - Download Sysinternals tools: [Sysinternals](https://docs.microsoft.com/en-us/sysinternals/downloads/)

#### Virtual Machines (VMs)
- Always test your malware in a Virtual Machine to prevent unintended damage to your host system and avoid spreading malware beyond the controlled environment.
  - Use VMware or VirtualBox to create isolated VMs where you can test and debug without affecting your actual system.
  - Take snapshots frequently so that you can revert to a clean state after running your malware.
  - Use a variety of Windows VMs (e.g., Windows 7, Windows 10, Windows 11) to see how your malware behaves on different OS versions.

#### Windows Sandbox
- If you want a lightweight testing environment, Windows Sandbox (available on Windows 10/11 Pro) is a temporary and isolated desktop environment where you can test suspicious files or malware.
  - To enable Windows Sandbox:
    1. Go to Control Panel → Programs → Turn Windows features on or off.
    2. Check Windows Sandbox, then restart your system.
  - The sandbox resets with every launch, providing a clean environment every time.

#### Testing Without Antivirus
- While developing, it’s best to initially disable the antivirus (AV) on your VM. This allows you to test and run your code without interference. Later, you can turn AV back on to see how it detects or blocks your malware, helping you refine evasion techniques.

# Additional Tools and Libraries

#### MinGW (Minimalist GNU for Windows)
- MinGW provides a simple GCC (GNU Compiler Collection)-based compiler for compiling C/C++ programs for Windows. It’s lightweight and can be useful when you need an alternative to Visual Studio's compiler.
  - Download: [MinGW Download](https://osdn.net/projects/mingw/releases/)

#### CMake
- For complex projects with dependencies, or if you’re planning to develop cross-platform malware, using CMake is recommended. It helps manage the build process for projects across multiple platforms.
  - You can install CMake as part of your Visual Studio installation or get it separately.
  - Set up CMake in Visual Studio by navigating to Tools → Options → CMake → CMake Settings.

#### Git for Version Control
- Use Git to version-control your malware projects, which is essential when iterating and testing different versions.
  - GitHub and GitLab are excellent for private version control, but ensure that your repositories are private to avoid leaking any malicious code to the public.
  - Install Git from: [Git Download](https://git-scm.com/)