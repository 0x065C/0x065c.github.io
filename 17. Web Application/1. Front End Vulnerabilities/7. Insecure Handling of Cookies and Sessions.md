# Index
- [[Front End Vulnerabilities]]
	- [[1. Sensitive Data Exposure]]
	- [[2. HTML Injection]]
	- [[3. Insecure Direct Object References (IDOR)]]
	- [[4. Cross-Site Scripting (XSS)]]
	- [[5. Cross-Site Request Forgery (CSRF)]]
	- [[6. Insufficient Transport Layer Protection]]
	- [[7. Insecure Handling of Cookies and Sessions]]
	- [[8. Security Misconfigurations|8. Security Misconfigurations]]

# Insecure Handling of Cookies and Sessions

Insecure Handling of Cookies and Sessions refers to the improper management of session tokens, cookies, and other mechanisms that are used to maintain user authentication and session state. When these are not securely handled, they can be exploited by attackers to impersonate users, hijack sessions, or steal sensitive information. Common issues include missing secure attributes on cookies, improper session management, or the exposure of session IDs in URLs.

# How Insecure Handling of Cookies and Sessions Works

1. **Insecure Cookie Attributes:** Cookies used for sessions may lack essential attributes like `HttpOnly`, `Secure`, or `SameSite`, making them vulnerable to theft through Cross-Site Scripting (XSS) or transmission over insecure channels.
2. **Session Fixation:** Attackers force a victim to use a known session ID, allowing them to hijack the session once the victim authenticates.
3. **Session ID Exposure in URLs:** Exposing session IDs in URL parameters or logs can lead to session hijacking if the URL is leaked or logged in browser history.
4. **Long-Lived or Non-Expiring Sessions:** Not implementing proper session expiration allows attackers to reuse valid session tokens for an extended period, increasing the risk of hijacking.
5. **Weak Session Tokens:** Using predictable or weakly generated session tokens makes it easier for attackers to guess or brute-force valid session IDs.

## Example of Insecure Handling of Cookies and Sessions

Let's examine an insecure session management scenario where session tokens are handled improperly:

1. **Session Token in URL:**
   A user is logged into a web application, and the session token is passed via the URL instead of in a secure cookie:

```html
http://example.com/account?session_id=abc123xyz
```

2. **Session Token Exposure:**
   If the user shares the URL or if it is logged in browser history, the session token can be stolen, allowing an attacker to hijack the session.

3. **Session Hijacking:**
   The attacker can then use the session ID to impersonate the victim and gain access to their account by directly visiting the URL with the stolen session ID:

```html
http://example.com/account?session_id=abc123xyz
```

# Types of Insecure Handling of Cookies and Sessions

## Missing `HttpOnly` Attribute
   - Without the `HttpOnly` attribute, cookies can be accessed via client-side scripts, making them vulnerable to XSS attacks.

## Missing `Secure` Attribute
   - Without the `Secure` attribute, cookies can be transmitted over HTTP instead of HTTPS, exposing them to interception by attackers through man-in-the-middle (MITM) attacks.

## Missing `SameSite` Attribute
   - Cookies without the `SameSite` attribute are vulnerable to Cross-Site Request Forgery (CSRF) attacks because they can be sent with cross-site requests.

## Session Fixation
   - If the application does not generate a new session ID after login, an attacker can trick a victim into using a known session ID and hijack their session.

## Session ID in URLs
   - Passing session IDs in URLs exposes them to leaks via referrer headers, browser history, or log files, leading to session hijacking.

## Long Session Expiration Time
   - Sessions that remain active for too long without expiring increase the risk of session reuse or hijacking.

# Manual Discovery Techniques for Insecure Handling of Cookies and Sessions

To manually discover insecure cookie and session management vulnerabilities, testers can analyze how cookies and session tokens are handled, looking for missing security attributes, exposed session IDs, and weak session management practices.

## Inspect Cookie Attributes

Use browser developer tools or interception tools like **Burp Suite** to inspect the cookies set by the application. Verify the presence of essential security attributes (`HttpOnly`, `Secure`, and `SameSite`).

### Example
- Analyze cookies in browser developer tools:

```plaintext
Set-Cookie: session_id=abc123xyz; Path=/; HttpOnly
```

- Check for:
  - **`HttpOnly`:** Prevents cookies from being accessed via JavaScript.
  - **`Secure`:** Ensures cookies are only sent over HTTPS.
  - **`SameSite`:** Prevents cookies from being sent with cross-site requests.

## Check for Session ID in URLs

Browse the application and monitor URLs to see if session tokens are passed in URL parameters. This can be done using developer tools or by analyzing network traffic with interception tools.

### Example

```html
http://example.com/account?session_id=abc123xyz
```

- If session tokens are visible in URLs, it indicates a vulnerability that can lead to session hijacking.

## Test Session Expiration and Reuse

Log in to the application and monitor how session tokens are handled over time. Test whether the session expires after a period of inactivity and if the same session token can be reused after logging out.

### Example
- **Session Expiration Test:** Log in, stay inactive for a specified period, and check if the session expires or remains active.
- **Session Reuse Test:** Log out and try reusing the session token to see if the session is invalidated after logout.

## Check for Session Fixation

Attempt a session fixation attack by setting a known session ID before login, and see if the session token is reused after authentication.

### Example
1. Set a known session ID before login:

```http
GET /login?session_id=abc123xyz HTTP/1.1
```

2. Log in and check if the session ID remains the same after authentication.

## Inspect Logs for Session IDs

Review application logs to ensure that session tokens or other sensitive data are not being logged in plaintext.

### Example
```plaintext
[INFO] User login: session_id=abc123xyz, username=john_doe
```

- If session IDs are logged, they could be exposed to unauthorized users via log files.

# Resources

| **Website** | **URL** |
|-------------|---------|
| OWASP - Session Management Cheat Sheet | [https://owasp.org/www-project-cheat-sheets/cheatsheets/Session_Management_Cheat_Sheet.html](https://owasp.org/www-project-cheat-sheets/cheatsheets/Session_Management_Cheat_Sheet.html) |
| OWASP - Secure Cookie Attributes | https://owasp.org/www-community/controls/SecureCookieAttribute |
| Veracode - Cookie and Session Security | [https://www.veracode.com/security/session-management](https://www.veracode.com/security/session-management) |
| GitHub - PayloadAllTheThings | [https://github.com/0x065C/PayloadsAllTheThings](https://github.com/0x065C/PayloadsAllTheThings) |