# Index
- [[Front End Vulnerabilities]]
	- [[1. Sensitive Data Exposure]]
	- [[2. HTML Injection]]
	- [[3. Insecure Direct Object References (IDOR)]]
	- [[4. Cross-Site Scripting (XSS)]]
	- [[5. Cross-Site Request Forgery (CSRF)]]
	- [[6. Insufficient Transport Layer Protection]]
	- [[7. Insecure Handling of Cookies and Sessions]]
	- [[8. Security Misconfigurations|8. Security Misconfigurations]]

# Cross-Site Request Forgery (CSRF)

Cross-Site Request Forgery (CSRF) is a type of attack that tricks a user into performing an action on a web application in which they are authenticated, without their knowledge or intent. The attacker exploits the trust that a web application has in the user's browser, making requests that are treated as if they were legitimate actions initiated by the user. These actions might include changing account settings, transferring funds, or even deleting data.

# How CSRF Works

1. **Victim Logs In:** The victim logs into a legitimate website, such as a bank or social media site, and a session cookie is stored in their browser.
2. **Attacker’s Malicious Request:** The attacker crafts a malicious request, embedding it in a hidden form, image tag, or link on another site.
3. **Victim’s Browser Sends Request:** When the victim visits the attacker’s malicious webpage, their browser automatically sends the crafted request to the legitimate site. Since the victim is already authenticated, the website processes the request, thinking it was initiated by the victim.
4. **Action Executed:** The requested action is executed on the website using the victim's session, without their knowledge.

## Example of a CSRF Attack

Imagine a user logged into a banking application at `bank.com`. The attacker wants to transfer funds from the victim’s account to their own account.

1. **Crafted Malicious Request:** The attacker creates a hidden form on a malicious site that sends a request to the banking site:

   ```html
   <img src="http://bank.com/transfer?amount=5000&to_account=attacker_account" style="display:none;">
   ```

2. **Victim Clicks Malicious Link:** The victim visits the attacker's website while still logged in to `bank.com`. The victim's browser sends the crafted request to `bank.com` with the session cookie.

3. **Action Completed:** The banking site processes the request as if it came from the victim, transferring the funds to the attacker's account.

# Types of CSRF Attacks

## GET-based CSRF
   - The attacker embeds a malicious link or image that triggers a GET request to the target site. The victim's browser makes the request, and the site processes it using the victim’s session cookie.
   - Example:

   ```html
   <img src="http://bank.com/transfer?amount=5000&to_account=attacker_account">
   ```

## POST-based CSRF
   - The attacker creates a form that submits data via a POST request to the target site, often hidden on a malicious page. The victim's browser sends the form data without their knowledge.
   - Example:

   ```html
   <form action="http://bank.com/transfer" method="POST">
     <input type="hidden" name="amount" value="5000">
     <input type="hidden" name="to_account" value="attacker_account">
   </form>
   <script>document.forms[0].submit();</script>
   ```

## XMLHttpRequest (XHR)-based CSRF
   - The attacker uses JavaScript's `XMLHttpRequest` to send requests behind the scenes, allowing POST or GET requests to be sent automatically using the victim's credentials.
   - Example:

   ```javascript
   var xhr = new XMLHttpRequest();
   xhr.open("POST", "http://bank.com/transfer", true);
   xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
   xhr.send("amount=5000&to_account=attacker_account");
   ```

# Manual Discovery Techniques for CSRF

To discover CSRF vulnerabilities in web applications, penetration testers can simulate attack scenarios by crafting requests that exploit the application’s trust in authenticated users. Below are manual techniques for identifying CSRF weaknesses.

## Identify Sensitive Actions

Look for actions within the web application that perform sensitive tasks, such as:
- **Fund transfers** in banking applications.
- **Changing account settings** (e.g., email or password).
- **Deleting or modifying records.**

These are potential targets for CSRF attacks.

## Craft and Test Malicious Requests

Manually create crafted requests that simulate potential CSRF attacks. Test these requests by embedding them into forms or images and observing the application's behavior.

### Example
- If a bank’s fund transfer form uses a GET request, you could test with an image link like:

```html
<img src="http://bank.com/transfer?amount=5000&to_account=attacker_account">
```

- For POST-based requests, create a hidden form to submit:

```html
<form action="http://bank.com/transfer" method="POST">
  <input type="hidden" name="amount" value="5000">
  <input type="hidden" name="to_account" value="attacker_account">
</form>
<script>document.forms[0].submit();</script>
```

### Testing
1. Embed the crafted request in a local HTML file.
2. Open the file in the browser while logged into the target web application.
3. Check if the action is executed, indicating a CSRF vulnerability.

## Use Interception Tools

Leverage tools like **Burp Suite** or **OWASP ZAP** to capture and modify requests to replicate CSRF attack scenarios.

### Example with Burp Suite
1. **Capture Request:**
   - Log into the target application and perform a sensitive action (e.g., transfer funds).
   - Capture the request using Burp Suite’s Proxy.

2. **Replay Request:**
   - Modify the captured request to craft a potential CSRF exploit (e.g., change the amount or recipient).
   - Send the request without user interaction to see if it is processed.

## Test for GET vs POST Handling

Many CSRF vulnerabilities occur due to applications accepting both GET and POST requests. Test if sensitive actions (such as account changes or fund transfers) can be triggered by sending GET requests when POST is expected.

### Example
- Attempt to perform an action (like changing a password) by directly navigating to a crafted URL:

```html
http://bank.com/change_password?new_password=newpass123
```

If the application processes the action, it may be vulnerable to CSRF.

# Resources

|**Website**|**URL**|
|-|-|
| OWASP - CSRF Prevention Cheat Sheet | https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html                                                      |
| OWASP - CSRF Guide | [https://owasp.org/www-community/attacks/csrf](https://owasp.org/www-community/attacks/csrf) |
| Veracode - CSRF Basics | [https://www.veracode.com/security/csrf](https://www.veracode.com/security/csrf) |
| GitHub - PayloadAllTheThings - CSRF Injection | [https://github.com/0x065C/PayloadsAllTheThings/tree/master/CSRF%20Injection](https://github.com/0x065C/PayloadsAllTheThings/tree/master/CSRF%20Injection) |