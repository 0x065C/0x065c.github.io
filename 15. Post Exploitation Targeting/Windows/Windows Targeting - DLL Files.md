Here’s an extensive breakdown of .DLL (Dynamic-Link Library) files that are commonly targeted for persistence and privilege escalation on Windows systems. Attackers often target DLL files by injecting malicious code into legitimate DLLs or abusing the way Windows loads DLLs to gain persistence or escalate privileges.

# Persistence

#### Criteria for Choosing a DLL for Persistence
- Load Frequency: The more frequently a DLL is loaded, the more effective it will be for persistence. Choose DLLs that are used by multiple processes or key services like `explorer.exe`, `svchost.exe`, etc.
- Directory Permissions: The target directory where the DLL is loaded from should have weak or insecure permissions (e.g., writable by non-admin users).
- Service or Application Target: The service or application loading the DLL should have a high uptime or run on startup for consistent persistence.

#### `apphelp.dll` (Application Compatibility Client Library)
   - Description: Helps manage application compatibility layers. This DLL is loaded during application execution and can be hijacked to achieve persistence in vulnerable applications.
   - Usage in Persistence:
     - Replace `apphelp.dll` in a vulnerable application’s directory to ensure that malicious code is executed whenever the application is launched.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_apphelp.dll" -Destination "C:\Windows\System32\apphelp.dll"
     ```

#### `mpr.dll` (Multiple Provider Router DLL)
   - Description: Handles network resource provider calls. Hijacking `mpr.dll` can ensure persistence by having the malicious DLL loaded whenever network resources are accessed.
   - Usage in Persistence:
     - Place a malicious `mpr.dll` in the application directory where it is loaded during startup or whenever the system interacts with network resources.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_mpr.dll" -Destination "C:\Windows\System32\mpr.dll"
     ```

#### `winlogon.exe` & `msgina.dll` (Windows Logon User Interface DLL)
   - Description: The Windows logon process relies on `msgina.dll` for handling logon and logoff procedures. Injecting a malicious `msgina.dll` ensures persistent access during system logon.
   - Usage in Persistence:
     - Replace or hijack `msgina.dll` so that it executes malicious code every time the user logs in.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_msgina.dll" -Destination "C:\Windows\System32\msgina.dll"
     ```

#### `rpcss.dll` (Remote Procedure Call Service DLL)
   - Description: Provides support for RPC functionality, which is essential for many Windows services. Hijacking this DLL allows malicious code to be executed when the RPC service starts, ensuring persistence.
   - Usage in Persistence:
     - Hijack `rpcss.dll` so that the malicious DLL is loaded whenever RPC services are invoked.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_rpcss.dll" -Destination "C:\Windows\System32\rpcss.dll"
     ```

#### `sfc.dll` (Windows System File Checker)
   - Description: The System File Checker (`sfc.dll`) helps maintain the integrity of Windows system files. Hijacking `sfc.dll` allows for persistent malicious code execution when the system attempts to validate files.
   - Usage in Persistence:
     - Replace `sfc.dll` with a malicious version that runs malicious code every time integrity checks are performed.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_sfc.dll" -Destination "C:\Windows\System32\sfc.dll"
     ```

#### `comctl32.dll` (Common Controls Library)
   - Description: Manages common control functions for applications, like buttons, scrollbars, and other UI elements. Hijacking this DLL allows malicious code to be executed when applications that rely on common controls are launched.
   - Usage in Persistence:
     - Inject a malicious `comctl32.dll` into the directory of an application that loads it during startup or system boot.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_comctl32.dll" -Destination "C:\Windows\System32\comctl32.dll"
     ```

#### `msvcr100.dll` (Microsoft C Runtime Library)
   - Description: Frequently loaded by numerous applications that use Microsoft’s C runtime. Hijacking this DLL can ensure that malicious code is executed by multiple applications upon system startup.
   - Usage in Persistence:
     - Replace `msvcr100.dll` in an application's directory to ensure that malicious code is loaded by any program depending on this runtime.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_msvcr100.dll" -Destination "C:\Program Files\<application>\msvcr100.dll"
     ```

#### `setupapi.dll` (Windows Setup API)
   - Description: Manages system setup and device installation. By hijacking this DLL, the attacker can ensure their code runs every time system setup or installation tasks are triggered.
   - Usage in Persistence:
     - Replace `setupapi.dll` in a vulnerable application to execute code whenever the system interacts with hardware or setup routines.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_setupapi.dll" -Destination "C:\Windows\System32\setupapi.dll"
     ```

#### `shfolder.dll` (Shell Folder Service)
   - Description: Provides access to special shell folders. Hijacking `shfolder.dll` ensures that malicious code is executed during any operation that interacts with shell folders, providing persistent access.
   - Usage in Persistence:
     - Inject a malicious `shfolder.dll` into the path where the application expects the legitimate version, triggering malicious execution whenever the system interacts with shell folders.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_shfolder.dll" -Destination "C:\Windows\System32\shfolder.dll"
     ```

#### `winmm.dll` (Windows Multimedia API)
   - Description: Provides multimedia services. Hijacking this DLL allows for persistence by ensuring that malicious code is executed whenever multimedia features are invoked, often during system startup or user sessions.
   - Usage in Persistence:
     - Replace or inject `winmm.dll` into an application that uses multimedia services to execute malicious code when invoked.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_winmm.dll")
     ```

#### `shell32.dll` (Windows Shell Common DLL)
   - Description: Manages many basic Windows shell functions like launching applications and managing the taskbar. Hijacking `shell32.dll` ensures that malicious code runs whenever the shell is accessed.
   - Usage in Persistence:
     - Inject a malicious `shell32.dll` into a vulnerable application directory or the system itself to ensure execution during system shell operations.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_shell32.dll" -Destination "C:\Windows\System32\shell32.dll"
     ```

#### `crypt32.dll` (Cryptographic API DLL)
   - Description: Provides cryptographic services for Windows. Replacing this DLL with a malicious one can ensure persistence by executing malicious code during cryptographic operations.
   - Usage in Persistence:
     - Replace `crypt32.dll` in a vulnerable application to ensure it is loaded during system or application cryptographic processes.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_crypt32.dll" -Destination "C:\Windows\System32\crypt32.dll"
     ```

#### `cryptui.dll` (Cryptographic User Interface DLL)
   - Description: Manages cryptographic operations involving user interaction. By hijacking `cryptui.dll`, you can ensure persistent code execution during cryptographic functions.
   - Usage in Persistence:
     - Inject `cryptui.dll` into a vulnerable process or directory, triggering malicious execution during cryptographic operations that require user interaction.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_cryptui.dll" -Destination "C:\Windows\System32\cryptui.dll"
     ```

#### `mswsock.dll` (Microsoft Windows Sockets Provider)
   - Description: Handles socket connections and network-related operations. Hijacking `mswsock.dll` ensures persistent code execution whenever network connections are initiated.
   - Usage in Persistence:
     - Replace or inject `mswsock.dll` into an application or process that uses Windows sockets, ensuring that malicious code is executed whenever network services are accessed.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_mswsock.dll")
     ```

#### `dnsapi.dll` (DNS Client API DLL)
   - Description: Manages DNS resolution. Hijacking `dnsapi.dll` can be used to execute malicious code whenever DNS lookups are performed, providing persistence.
   - Usage in Persistence:
     - Inject a malicious `dnsapi.dll` into a

 network-related application to trigger its execution whenever DNS services are accessed.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_dnsapi.dll" -Destination "C:\Windows\System32\dnsapi.dll"
     ```

#### `taskschd.dll` (Task Scheduler Service DLL)
   - Description: Manages the Windows Task Scheduler service. Hijacking this DLL allows for persistent execution of malicious code whenever tasks are scheduled or executed.
   - Usage in Persistence:
     - Replace `taskschd.dll` in a vulnerable directory to execute malicious code during task scheduling or execution.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_taskschd.dll" -Destination "C:\Windows\System32\taskschd.dll"
     ```

#### `dbghelp.dll` (Debugging Helper Library)
   - Description: Provides functions for generating debugging information. Hijacking this DLL can be used to ensure persistent code execution during system diagnostics or crash handling.
   - Usage in Persistence:
     - Inject a malicious `dbghelp.dll` into an application or directory to ensure that the malicious code runs during system diagnostics.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_dbghelp.dll")
     ```

# Privilege Escalation

When performing privilege escalation on a Windows host using DLL hijacking or injection techniques, it is critical to identify commonly misused DLLs that allow an attacker to escalate privileges by exploiting weak configurations or design flaws. Here's a list of DLLs that are frequently targeted in privilege escalation attacks, along with their characteristics:

#### `msvcrt.dll` (Microsoft Visual C++ Runtime Library)
   - Description: A key runtime component for running C++ applications. Vulnerable applications may fail to verify the integrity or path of this DLL, allowing attackers to inject a malicious version for privilege escalation.
   - Usage in Privilege Escalation:
     - Inject a malicious DLL into a vulnerable process relying on `msvcrt.dll`.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_msvcrt.dll")
     ```

#### `cryptsp.dll` (Cryptographic Service Provider API)
   - Description: Handles cryptographic services in Windows. Misconfigurations or unverified DLL loading may allow malicious DLLs to be loaded.
   - Usage in Privilege Escalation:
     - Replace this DLL in vulnerable processes using DLL search order hijacking.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_cryptsp.dll" -Destination "C:\Windows\System32\cryptsp.dll"
     ```

#### `user32.dll` (Windows User API Client DLL)
   - Description: Implements user interface functions. Weak permissions or unverified loading in user applications may allow privilege escalation.
   - Usage in Privilege Escalation:
     - Inject into a vulnerable process that relies on user32.dll for UI operations.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("C:\malicious_user32.dll")
     ```

#### `ntdll.dll` (Windows NT Layer DLL)
   - Description: Provides native system services and is critical for system operations. Replacing this DLL in a vulnerable application could allow executing malicious code with higher privileges.
   - Usage in Privilege Escalation:
     - Replace the `ntdll.dll` in an unprotected directory with a malicious version.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_ntdll.dll" -Destination "C:\Windows\System32\ntdll.dll"
     ```

#### `version.dll` (Version Checking and File Information API)
   - Description: This DLL is often targeted because many applications load it dynamically to check file versions. It’s commonly exploited in DLL hijacking.
   - Usage in Privilege Escalation:
     - Planting a malicious `version.dll` in the application's directory, which is loaded instead of the legitimate one.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_version.dll")
     ```

#### `wininet.dll` (Internet Extensions for Win32)
   - Description: Manages internet-related API calls. Applications relying on this DLL may be vulnerable to hijacking, especially if they improperly handle DLL loading paths.
   - Usage in Privilege Escalation:
     - Inject a malicious `wininet.dll` into a vulnerable application that does not validate DLL integrity.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_wininet.dll")
     ```

#### `ws2_32.dll` (Windows Sockets API)
   - Description: Handles network communication for Windows. Attackers can target this DLL if applications rely on it without proper verification.
   - Usage in Privilege Escalation:
     - Substitute a malicious version of `ws2_32.dll` in a directory where the application loads DLLs.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_ws2_32.dll" -Destination "C:\Program Files\<application>\ws2_32.dll"
     ```

#### `advapi32.dll` (Advanced Windows 32 Base API)
   - Description: Provides access to advanced Windows features such as registry and service management. Targeting this DLL could lead to privilege escalation through improper permissions.
   - Usage in Privilege Escalation:
     - Use DLL injection to run malicious code with elevated privileges.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_advapi32.dll" -Destination "C:\Windows\System32\advapi32.dll"
     ```

#### `shell32.dll` (Windows Shell Common DLL)
   - Description: Provides basic Windows shell functions. This DLL can be replaced to escalate privileges in vulnerable applications.
   - Usage in Privilege Escalation:
     - Inject a malicious DLL into an application that dynamically loads `shell32.dll`.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_shell32.dll" -Destination "C:\Program Files\<application>\shell32.dll"
     ```

#### `oleaut32.dll` (OLE Automation DLL)
   - Description: Used in Object Linking and Embedding (OLE) functionality, this DLL is vulnerable to hijacking when not properly secured in older applications.
   - Usage in Privilege Escalation:
     - Replace this DLL with a malicious one in applications that do not enforce DLL signature checks.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_oleaut32.dll" -Destination "C:\Windows\System32\oleaut32.dll"
     ```

#### `netapi32.dll` (Net API DLL)
   - Description: Provides network-related services. Often loaded by various applications to interface with the Windows networking stack, making it a target for DLL hijacking.
   - Usage in Privilege Escalation:
     - Plant a malicious `netapi32.dll` in an application’s working directory where it may be loaded without verification.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_netapi32.dll" -Destination "C:\Windows\System32\netapi32.dll"
     ```

#### `dnsapi.dll` (DNS Client API DLL)
   - Description: Handles DNS resolution in Windows. Applications that use DNS may call this DLL, which makes it vulnerable to DLL hijacking or injection.
   - Usage in Privilege Escalation:
     - Replace this DLL with a malicious version in vulnerable applications that do not verify its integrity.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_dnsapi.dll" -Destination "C:\Windows\System32\dnsapi.dll"
     ```

#### `rpcrt4.dll` (Remote Procedure Call Runtime)
   - Description: This DLL manages RPC communications between processes. Vulnerabilities in how applications use `rpcrt4.dll` can be exploited through DLL hijacking.
   - Usage in Privilege Escalation:
     - Inject a malicious `rpcrt4.dll` into a program that improperly loads DLLs from unprotected locations.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("C:\malicious_rpcrt4.dll")
     ```

#### `setupapi.dll` (Windows Setup API)
   - Description: Provides access to device installation and system setup functions. Misconfigured applications loading `setupapi.dll` without proper verification may be vulnerable to DLL hijacking.
   - Usage in Privilege Escalation:
     - Inject a malicious `setupapi.dll` into a process responsible for device or setup configurations.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_setupapi.dll" -Destination "C:\Windows\System32\setupapi.dll"
     ```

#### `ole32.dll` (Object Linking and Embedding (OLE) API)
   - Description: Implements functionality for OLE operations. Applications using OLE without properly verifying `ole32.dll` can be exploited through DLL hijacking.
   - Usage in Privilege Escalation:
     - Replace `ole32.dll` in a vulnerable directory where an application looks for it.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_ole32.dll")
     ```

#### `kernelbase.dll` (Windows Kernel API DLL)
   - Description: Provides kernel-level functions for applications. Kernel-level access makes this a valuable target for privilege escalation when unverified by vulnerable applications.
   - Usage in Privilege Escalation:
     - Inject a malicious `kernelbase.dll` into a process running with elevated privileges.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_kernelbase.dll" -Destination "C:\Windows\System32\kernelbase.dll"
     ```

####  `gdi32.dll` (Graphics Device Interface)
   - Description: Handles graphical device interface operations for rendering graphical content. It’s often loaded dynamically, making it susceptible to DLL hijacking.
   - Usage in Privilege Escalation:
     - Replace `gdi32.dll` in the application’s directory to load the malicious version instead of the system-protected one.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_gdi32.dll")
     ```

#### 1`comdlg32.dll` (Common Dialog Box Library)
   - Description: Provides common dialog boxes, such as file open and save dialog boxes. When not properly protected, it can be hijacked by placing a malicious DLL in the same directory as the executable that uses it.
   - Usage in Privilege Escalation:
     - Substitute the legitimate `comdlg32.dll` in a vulnerable process with a malicious version.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_comdlg32.dll" -Destination "C:\Program Files\<application>\comdlg32.dll"
     ```

#### 1`wsock32.dll` (Windows Sockets 32)
   - Description: Similar to `ws2_32.dll`, this DLL handles older network socket communications. It can be targeted in legacy applications that haven’t been updated to verify DLL integrity.
   - Usage in Privilege Escalation:
     - Inject or replace `wsock32.dll` in a legacy application’s directory to escalate privileges.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_wsock32.dll")
     ```

#### 20. `uxtheme.dll` (Microsoft UxTheme Library)
   - Description: Provides theme support for the Windows GUI. Since some applications load it dynamically, `uxtheme.dll` can be hijacked in vulnerable applications.
   - Usage in Privilege Escalation:
     - Replace `uxtheme.dll` in an application’s working directory to execute arbitrary code.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_uxtheme.dll" -Destination "C:\Windows\System32\uxtheme.dll"
     ```

#### 2`shlwapi.dll` (Shell Light-weight Utility Library)
   - Description: Provides utility functions for string manipulation, path parsing, etc. Applications that load `shlwapi.dll` dynamically without integrity checks can be vulnerable to DLL hijacking.
   - Usage in Privilege Escalation:
     - Substitute `shlwapi.dll` in a vulnerable process with a malicious version.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_shlwapi.dll")
     ```

#### 2`wlanapi.dll` (Windows Wireless LAN API)
   - Description: Provides functions to manage wireless networks. This DLL can be hijacked if an application that uses wireless functions fails to validate its DLLs.
   - Usage in Privilege Escalation:
     - Inject a malicious `wlanapi.dll` into a process that manages wireless configurations.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_wlanapi.dll" -Destination "C:\Windows\System32\wlanapi.dll"
     ```

#### 2`powrprof.dll` (Power Profile Helper DLL)
   - Description: Manages power profile settings. Attackers can exploit poorly configured applications loading this DLL to gain higher privileges.
   - Usage in Privilege Escalation:
     - Replace or inject `powrprof.dll` in a power management process that does not properly verify its DLLs.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_powrprof.dll")
     ```

#### 2`mpr.dll` (Multiple Provider Router DLL)
   - Description: Manages network resource provider calls. This DLL is often loaded dynamically, and if not verified properly, can be replaced or hijacked.
   - Usage in Privilege Escalation:
     - Replace `mpr.dll` in a vulnerable application to load the malicious version and execute arbitrary code.
   - PowerShell Example:
     ```powershell
     [System.Reflection.Assembly]::LoadFile("<path_to_attack_dll>\malicious_mpr.dll")
     ```

#### 2`bcrypt.dll` (Windows Cryptographic Primitives Library)
   - Description: Provides cryptographic functions. It is targeted for privilege escalation in applications that load it without integrity checks.
   - Usage in Privilege Escalation:
     - Inject or replace `bcrypt.dll` in a cryptographic application for privilege escalation.
   - PowerShell Example:
     ```powershell
     Copy-Item -Path "C:\malicious_bcrypt.dll" -Destination "C:\Windows\System32\bcrypt.dll"
     ```
