# Index
- [[Cloud]]
	- [[1.0 Amazon Web Service (AWS)]]
	- [[2.0 Microsoft Azure]]
	- [[3.0 Google Cloud Services (GCS)]]
	- [[4.0 SalesForce Cloud]]

# Summary
- **Service Name:** Google Cloud Platform (GCP)
- **Category:** Cloud Computing Platform
- **Components:** Compute, Storage, Database, Networking, Analytics, Machine Learning, IoT, Security, and more.

## Google Cloud Platform Overview
Google Cloud Platform (GCP) is a suite of cloud computing services provided by Google. It runs on the same infrastructure that Google uses internally for its end-user products, such as Google Search, Gmail, file storage, and YouTube. GCP offers a wide range of services including computing, data storage, data analytics, and machine learning.

GCP provides a mix of IaaS (Infrastructure as a Service), PaaS (Platform as a Service), and SaaS (Software as a Service) offerings. It enables businesses to build, test, and deploy applications on a highly scalable and reliable infrastructure.

## How GCP Works
GCP operates through a global network of data centers managed by Google. These data centers are organized into regions and zones. Each region is a separate geographic area, and each region has multiple zones. This structure provides high availability, fault tolerance, and scalability.

1. **Global Infrastructure:**
    - **Regions:** Geographic locations around the world where GCP clusters its data centers.
    - **Zones:** Multiple isolated locations within each region that provide redundancy and fault tolerance.
    
2. **Services and Resources:**
    - **Compute:** Services like Compute Engine, App Engine, and Kubernetes Engine offer flexible computing power.
    - **Storage:** Cloud Storage, Persistent Disks, and Filestore provide various storage solutions.
    - **Databases:** Managed database services like Cloud SQL, Cloud Spanner, and Firestore.
    - **Networking:** Virtual Private Cloud (VPC), Cloud Load Balancing, and Cloud CDN offer robust networking capabilities.
    - **Developer Tools:** Services like Cloud Build, Cloud Source Repositories, and Cloud Functions support the software development lifecycle.
    - **Security and Identity:** Identity and Access Management (IAM), Cloud Key Management, and Security Command Center provide security and identity management.

## Key GCP Services

### Compute

- **Google Compute Engine:**
    - Provides scalable virtual machines (VMs).        
    - VMs can be launched, resized, and terminated as needed.        
    - Supports a wide range of machine types optimized for different tasks.	    
    - **Configuration:**        
        - Compute Engine instances can be configured with various machine types, custom images, persistent disks, and network settings.
        - **Example:** Launching a Compute Engine instance with a specific machine type and disk:

```
gcloud compute instances create my-instance --zone=us-central1-a --machine-type=e2-medium --boot-disk-size=10GB --boot-disk-type=pd-standard
```

- **Google App Engine:**
    - A fully managed platform for building and deploying applications.        
    - Supports multiple programming languages including Python, Java, Go, and PHP.        
    - Ideal for web applications and APIs.	    
    - **Configuration:**        
        - App Engine applications can be configured with scaling settings, environment variables, and custom domains.
        - **Example:** Deploying an application to App Engine:

```
gcloud app deploy app.yaml
```

- **Google Kubernetes Engine (GKE):**
    - A managed Kubernetes service for running containerized applications.        
    - Supports Docker containers and Kubernetes orchestration.	    
    - **Configuration:**        
        - GKE clusters can be configured with node pools, auto-scaling, and networking settings.
        - **Example:** Creating a GKE cluster:

```
gcloud container clusters create my-cluster --zone us-central1-a --num-nodes 3
```

### Storage

- **Google Cloud Storage:**
    - Object storage service that offers scalability, data availability, security, and performance.        
    - Stores data as objects within buckets.        
    - Ideal for backup, archiving, and big data analytics.	    
    - **Configuration:**        
        - Cloud Storage buckets can be configured with versioning, lifecycle policies, and access controls.
        - **Example:** Creating a bucket with versioning enabled:

```
gsutil mb gs://my-bucket gsutil versioning set on gs://my-bucket
```

- **Google Persistent Disk:**
    - Provides persistent block storage for use with Compute Engine.        
    - Disks can be dynamically attached to instances and support high throughput and low latency.        	    
    - **Configuration:**        
        - Persistent Disks can be configured with encryption, snapshot settings, and disk types.
        - **Example:** Creating an encrypted persistent disk:

```
gcloud compute disks create my-disk --size=10GB --zone=us-central1-a --type=pd-standard --kms-key=<kms-key>
```

- **Google Cloud Filestore:**
    - Fully managed file storage service.        
    - Provides network-attached storage for Compute Engine instances.      	    
    - **Configuration:**        
        - Filestore instances can be configured with capacity settings and access controls.
        - **Example:** Creating a Filestore instance:

```
gcloud filestore instances create my-filestore --zone=us-central1-a --tier=STANDARD --file-share=name="share1",capacity=1TB --network=name="default"
```

### Databases

- **Google Cloud SQL:**
    - Managed relational database service supporting MySQL, PostgreSQL, and SQL Server.        
    - Automates common administrative tasks such as backups, patching, and scaling.	    
    - **Configuration:**        
        - Cloud SQL instances can be configured with database engine, instance type, storage size, and network settings.
        - **Example:** Creating a Cloud SQL instance with MySQL:

```
gcloud sql instances create my-instance --database-version=MYSQL_8_0 --cpu=2 --memory=7680MB --zone=us-central1-a
```

- **Google Cloud Spanner:**
    - Fully managed relational database service designed for global scale and high availability.        
    - Supports horizontal scaling and strongly consistent transactions.	    
    - **Configuration:**        
        - Cloud Spanner instances can be configured with instance configuration, nodes, and regional settings.
        - **Example:** Creating a Cloud Spanner instance:

```
gcloud spanner instances create my-instance --config=regional-us-central1 --nodes=1 --description="My Spanner instance"
```

- **Google Firestore:**
    - Fully managed NoSQL document database.        
    - Provides real-time synchronization and offline support for web and mobile applications.        	    
    - **Configuration:**        
        - Firestore can be configured in Native mode or Datastore mode.
        - **Example:** Creating a Firestore database in Native mode:

```
gcloud firestore databases create --region=us-central1 --type=native
```

### Networking

- **Google Virtual Private Cloud (VPC):**
    - Provides isolated virtual networks for deploying GCP resources.        
    - Offers control over IP address ranges, subnets, route tables, and firewall rules.    	    
    - **Configuration:**        
        - VPCs can be configured with custom subnets, routes, and firewall rules.
        - **Example:** Creating a VPC with subnets:

```
gcloud compute networks create my-vpc --subnet-mode=custom gcloud compute networks subnets create my-subnet --network=my-vpc --range=10.0.0.0/24 --region=us-central1
```

- **Google Cloud Load Balancing:**
    - Provides scalable and high-performance load balancing for GCP resources.        
    - Supports HTTP(S), TCP/SSL, and UDP traffic.        	    
    - **Configuration:**        
        - Load balancers can be configured with backend services, URL maps, and health checks.
        - **Example:** Creating an HTTP(S) load balancer:

```
gcloud compute backend-services create my-backend-service --protocol=HTTP --port-name=http --health-checks=my-health-check --global
gcloud compute url-maps create my-url-map --default-service=my-backend-service
gcloud compute target-http-proxies create my-http-proxy --url-map=my-url-map
gcloud compute forwarding-rules create my-http-rule --global --target-http-proxy=my-http-proxy --ports=80
```

- **Google Cloud CDN:**
    - Content delivery network service that accelerates content delivery.        
    - Caches content at edge locations to improve latency and performance.   	    
    - **Configuration:**        
        - CDN can be configured with backend buckets and cache policies.
        - **Example:** Enabling CDN for a backend bucket:

```
gcloud compute backend-buckets create my-backend-bucket --gcs-bucket-name=my-bucket --enable-cdn
```

### Security and Identity

- **Google Identity and Access Management (IAM):**
    - Controls access to GCP services and resources.        
    - Manages users, groups, roles, and permissions.    	    
    - **Configuration:**        
        - IAM policies, roles, and service accounts can be configured to manage access controls.
        - **Example:** Creating a service account and assigning a role:

```
gcloud iam service-accounts create my-service-account --display-name "My Service Account"
gcloud projects add-iam-policy-binding my-project --member="serviceAccount:my-service-account@my-project.iam.gserviceaccount.com" --role="roles/editor"
```

- **Google Cloud Key Management Service (KMS):**
    - Managed service for creating and controlling encryption keys.        
    - Ensures data is securely encrypted at rest and in transit.  	    
    - **Configuration:**        
        - KMS keys can be configured with key rings, key versions, and IAM policies.
        - **Example:** Creating a key ring and a key:

```
gcloud kms keyrings create my-key-ring --location=global gcloud kms keys create my-key --location=global --keyring=my-key-ring --purpose=encryption
```

- **Google Security Command Center:**
    - Comprehensive security and risk management platform.        
    - Provides visibility into assets, vulnerabilities, and threats.   	    
    - **Configuration:**        
        - Security Command Center can be configured with sources, findings, and notifications.
        - **Example:** Enabling Security Command Center:

```
gcloud alpha scc settings update --organization=1234567890 --update-mask=enabled_modules --set-enabled_modules=FINDING_MANAGEMENT
```

## GCP Example Use Case

### Web Application Hosting

1. **Deployment:**
    - Deploy the application on Google Compute Engine instances.        
    - Use Managed Instance Groups to adjust the number of instances based on demand.        
    - **Configuration:**        
        - Define instance templates, managed instance groups, and auto-scaling policies.
        - **Example:** Creating a managed instance group:

```
gcloud compute instance-templates create my-template --machine-type=e2-medium --boot-disk-size=10GB --boot-disk-type=pd-standard
gcloud compute instance-groups managed create my-group --base-instance-name=my-instance --size=1 --template=my-template --zone=us-central1-a
gcloud compute instance-groups managed set-autoscaling my-group --max-num-replicas=5 --min-num-replicas=1 --target-cpu-utilization=0.75 --zone=us-central1-a
```

2. **Storage:**
    - Store static assets (images, videos) in Google Cloud Storage.        
    - Use Persistent Disks for persistent block storage attached to Compute Engine instances.        
    - **Configuration:**        
        - Set up Cloud Storage bucket policies and Persistent Disk attachments.
        - **Example:** Attaching a persistent disk to an instance:

```
gcloud compute instances attach-disk my-instance --disk=my-disk --zone=us-central1-a
```

3. **Database:**
    - Use Google Cloud SQL for the relational database backend.        
    - Optionally, use Google Firestore for handling high-throughput, low-latency NoSQL database needs.        
    - **Configuration:**        
        - Configure Cloud SQL instances and Firestore databases.
        - **Example:** Setting up a Cloud SQL MySQL database:

```
gcloud sql instances create my-instance --database-version=MYSQL_8_0 --cpu=2 --memory=7680MB --zone=us-central1-a
```

4. **Networking:**
	- Set up a VPC to isolate the applicationâ€™s network.    
	- Use HTTP(S) Load Balancing to distribute traffic across multiple Compute Engine instances.    
	- **Configuration:**    
	    - Configure VPC subnets, firewall rules, and load balancer settings.
	    - **Example:** Creating an HTTP(S) load balancer:

```
gcloud compute backend-services create my-backend-service --protocol=HTTP --port-name=http --health-checks=my-health-check --global
gcloud compute url-maps create my-url-map --default-service=my-backend-service
gcloud compute target-http-proxies create my-http-proxy --url-map=my-url-map
gcloud compute forwarding-rules create my-http-rule --global --target-http-proxy=my-http-proxy --ports=80
```

5. **Security:**
    - Use IAM to manage access control and permissions.        
    - Implement SSL/TLS for secure data transmission.        
    - Use Security Command Center to monitor and protect against security threats.        
    - **Configuration:**        
        - Configure IAM policies, SSL certificates, and Security Command Center settings.
        - **Example:** Creating an SSL certificate using Google-managed certificates:

```
gcloud compute ssl-certificates create my-ssl-cert --domains=example.com
```

6. **Monitoring and Logging:**
    - Use Google Cloud Monitoring to monitor application performance and resource utilization.        
    - Use Google Cloud Logging to log and audit API calls.        
    - **Configuration:**        
        - Set up Monitoring dashboards, alerts, and Logging sinks.
        - **Example:** Creating a monitoring alert policy:

```
gcloud monitoring policies create --policy-from-file=policy.json
```

# Additional Information

## Configuration Files

IAM Policy Example

```
{
  "bindings": [
    {
      "role": "roles/viewer",
      "members": [
        "user:example-user@gmail.com"
      ]
    },
    {
      "role": "roles/editor",
      "members": [
        "serviceAccount:my-service-account@my-project.iam.gserviceaccount.com"
      ]
    }
  ]
}
```

Firewall Rule Example

```
{
  "description": "Allow SSH and HTTP access",
  "name": "allow-ssh-http",
  "network": "global/networks/default",
  "sourceRanges": [
    "0.0.0.0/0"
  ],
  "allowed": [
    {
      "IPProtocol": "tcp",
      "ports": [
        "22",
        "80"
      ]
    }
  ]
}
```

## Potential Misconfigurations

- **Open Cloud Storage Buckets:** Publicly accessible Cloud Storage buckets can lead to data leakage.
- **Overly Permissive IAM Policies:** Using wildcards (*) in IAM policies can grant excessive permissions.
- **Firewall Rules with Open Ports:** Allowing inbound traffic from any IP address (0.0.0.0/0) can expose resources to attacks.
- **Unrestricted Cloud Functions:** Granting broad permissions to Cloud Functions can lead to privilege escalation.
- **Unencrypted Data:** Failing to encrypt data at rest and in transit can expose sensitive information.

## Default Credentials

- **GCP accounts should never use default credentials:** Always create individual IAM users with specific permissions.
- **Rotate Access Keys:** Regularly rotate access keys to minimize the risk of credential leakage.
- **Use Service Accounts:** Assign service accounts to services instead of using long-term access keys.

# Interaction and Tools

## Reconnaissance and Enumeration Tools

- **GCP CLI (gcloud):** Command-line tool to interact with GCP services.

```
gcloud compute instances list gcloud storage ls
```

- **Cloud Security Command Center:** Security and risk management platform.
- **ScoutSuite:** Multi-cloud security-auditing tool for GCP, AWS, and Azure.

```
scoutsuite scan gcp --services compute,storage,iam
```

## Vulnerability Scanning Tools

- **Nessus:** Vulnerability scanner that can scan GCP environments for common vulnerabilities.
- **Forseti Security:** GCP security toolkit for assessing security policies and configurations.

```
forseti inventory list
```

## Exploitation Tools

- **Metasploit:** Framework for developing and executing exploit code.
- **Empire:** Post-exploitation framework for maintaining access and conducting lateral movement.
- **GCP Exploitation Framework (Pacu):** Tool designed to facilitate penetration testing in GCP environments.

```
pacu --profile default
```

## Monitoring and Logging Tools

- **Cloud Logging:** GCP service that logs API calls.
- **Cloud Monitoring:** Monitoring and observability service for GCP resources.
- **Cloud Security Command Center:** Threat detection service that continuously monitors for malicious activity.

# Common Exploits

## Compute (Compute Engine)

- **Instance Metadata Service Exploitation:** Exploiting the instance metadata service to retrieve sensitive information.
- **Privilege Escalation:** Exploiting IAM role misconfigurations to escalate privileges.
- **Compute Engine Instance Metadata Service Exploitation**
	- **Exploit:** Accessing sensitive data such as IAM role credentials through the metadata service.
	- **Mitigation:** Restrict access to the metadata server from untrusted networks.

```
curl "http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token" -H "Metadata-Flavor: Google"
```

## Storage (Cloud Storage)

- **Bucket Enumeration and Data Exfiltration:** Identifying and accessing publicly accessible Cloud Storage buckets.
- **Data Leakage:** Exfiltrating sensitive data from misconfigured buckets.
- **Public Cloud Storage Bucket Exposure**
	- **Exploit:** Accessing publicly accessible Cloud Storage buckets to exfiltrate data.
	- **Mitigation:** Use bucket policies and access controls to restrict access.

```
{
  "bindings": [
    {
      "role": "roles/storage.objectViewer",
      "members": [
        "user:example-user@gmail.com"
      ]
    }
  ]
}
```

## Database (Cloud SQL)

- **SQL Injection:** Exploiting SQL injection vulnerabilities in web applications to access the database.
- **Public Exposure:** Exploiting publicly accessible Cloud SQL instances to gain unauthorized access.

## IAM

- **Credential Leakage:** Exploiting leaked credentials to gain unauthorized access to GCP resources.
- **Role Assumption:** Assuming IAM roles with excessive permissions to escalate privileges.
- **IAM Role Privilege Escalation**
	- **Exploit:** Exploiting weak IAM role policies to escalate privileges.
	- **Mitigation:** Regularly review and tighten IAM policies, ensuring the principle of least privilege.

```
{
  "bindings": [
    {
      "role": "roles/viewer",
      "members": [
        "user:example-user@gmail.com"
      ]
    },
    {
      "role": "roles/editor",
      "members": [
        "serviceAccount:my-service-account@my-project.iam.gserviceaccount.com"
      ]
    }
  ]
}
```

## Networking (VPC)

- **Open Ports:** Exploiting open ports and services exposed within the VPC.
- **Network Misconfiguration:** Exploiting misconfigured subnets and routing tables to access restricted resources.
- **VPC Misconfiguration**
	- **Exploit:** Exploiting open firewall rules and misconfigured routes to access restricted resources.
	- **Mitigation:** Use strict firewall rules and routes to control traffic.

```
{
  "description": "Allow SSH from corporate network",
  "name": "allow-ssh",
  "network": "global/networks/default",
  "sourceRanges": [
    "203.0.113.0/24"
  ],
  "allowed": [
    {
      "IPProtocol": "tcp",
      "ports": [
        "22"
      ]
    }
  ]
}
```

## Serverless (Cloud Functions)

- **Code Injection:** Injecting malicious code into Cloud Functions to execute unauthorized actions.
- **Event Injection:** Triggering Cloud Functions with crafted events to exploit vulnerabilities.
- **Cloud Function Misuse**
	- **Exploit:** Exploiting overly permissive Cloud Function execution roles to perform unauthorized actions.
	- **Mitigation:** Assign minimal permissions required for Cloud Functions and use IAM conditions to restrict actions.

```
{
  "bindings": [
    {
      "role": "roles/cloudfunctions.invoker",
      "members": [
        "user:example-user@gmail.com"
      ]
    }
  ]
}
```