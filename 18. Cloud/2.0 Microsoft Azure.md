# Index
- [[Cloud]]
	- [[1.0 Amazon Web Service (AWS)]]
	- [[2.0 Microsoft Azure]]
	- [[3.0 Google Cloud Services (GCS)]]
	- [[4.0 SalesForce Cloud]]

# Summary
- **Service Name:** Microsoft Azure
- **Category:** Cloud Computing Platform
- **Components:** Compute, Storage, Database, Networking, Analytics, Machine Learning, IoT, Security, and more.

## Microsoft Azure Overview
Microsoft Azure is a comprehensive cloud computing platform provided by Microsoft. It offers a wide range of cloud services, including those for computing, analytics, storage, and networking. Users can choose and configure these services to develop and scale new applications, or run existing applications in the public cloud.

Azure provides a mix of IaaS (Infrastructure as a Service), PaaS (Platform as a Service), and SaaS (Software as a Service). This broad selection of services allows businesses to design and deploy a wide range of applications and services with high availability, fault tolerance, and scalability.

## How Azure Works
Azure operates through a global network of Microsoft-managed data centers, which are organized into regions and availability zones (AZs). Each region consists of one or more data centers and is isolated from others to ensure fault tolerance. Availability zones within a region provide additional redundancy.

1. **Global Infrastructure:**
    - **Regions:** Geographic locations around the world where Microsoft clusters its data centers.
    - **Availability Zones (AZs):** Physically separate locations within each region, providing redundancy and fault tolerance.
    
1. **Services and Resources:**
    - **Compute:** Services like Azure Virtual Machines, Azure Functions, and Azure Kubernetes Service (AKS) provide scalable computing power.
    - **Storage:** Azure Blob Storage, Azure Disk Storage, and Azure Archive Storage offer various storage solutions.
    - **Databases:** Managed database services like Azure SQL Database, Cosmos DB, and Azure Database for PostgreSQL.
    - **Networking:** Azure Virtual Network (VNet), Azure DNS, and ExpressRoute offer robust networking capabilities.
    - **Developer Tools:** Services like Azure DevOps, Azure Repos, and Azure Pipelines support the software development lifecycle.
    - **Security and Identity:** Azure Active Directory (AAD), Azure Key Vault, and Azure Security Center provide security and identity management.

## Key Azure Services

### Compute

- **Azure Virtual Machines (VMs):**    
    - Provides scalable virtual servers.
    - VMs can be launched, resized, and terminated as needed.
    - Supports a wide range of VM types optimized for different tasks.    
    - **Configuration:**        
        - VMs can be configured with various instance sizes, images, storage options, and network settings.
        - **Example:** Launching a VM with a specific image and network security group:

```
az vm create --resource-group MyResourceGroup --name MyVM --image UbuntuLTS --admin-username azureuser --generate-ssh-keys
```

- **Azure Functions:**    
    - A serverless compute service that runs code in response to events.
    - Automatically scales based on demand.
    - Ideal for event-driven applications and microservices.	    
    - **Configuration:**        
        - Functions can be configured with memory size, timeout settings, and triggers.
        - **Example:** Creating a function app using Azure CLI:

```
az functionapp create --resource-group MyResourceGroup --consumption-plan-location westus --runtime python --runtime-version 3.8 --functions-version 3 --name MyFunctionApp --storage-account MyStorageAccount
```

- **Azure Kubernetes Service (AKS):**    
    - A managed container orchestration service based on Kubernetes.
    - Simplifies deployment, management, and operations of Kubernetes clusters.	  
    - **Configuration:**        
        - AKS clusters can be configured with node pools, networking settings, and RBAC policies.
        - **Example:** Creating an AKS cluster:

```
az aks create --resource-group MyResourceGroup --name MyAKSCluster --node-count 3 --enable-addons monitoring --generate-ssh-keys
```

### Storage

- **Azure Blob Storage:**    
    - Object storage service for unstructured data such as text or binary data.
    - Scalable, durable, and secure.	    
    - **Configuration:**        
        - Blob storage can be configured with access tiers, lifecycle management policies, and replication options.
        - **Example:** Creating a blob storage container:

```
az storage container create --name mycontainer --account-name mystorageaccount
```

- **Azure Disk Storage:**    
    - Provides persistent block storage for use with Azure VMs.
    - Offers high performance and low latency.	    
    - **Configuration:**        
        - Disks can be configured with various performance tiers, encryption, and snapshot settings.
        - **Example:** Creating a managed disk:

```
az disk create --resource-group MyResourceGroup --name MyManagedDisk --size-gb 128 --sku Premium_LRS
```

- **Azure Archive Storage:**    
    - Low-cost storage service for data archiving and long-term backup.
    - Provides secure and durable storage for infrequently accessed data.	    
    - **Configuration:**        
        - Archive storage can be configured with access policies and lifecycle management rules.
        - **Example:** Creating an archive storage container:

```
az storage container create --name myarchivecontainer --account-name mystorageaccount --access-tier Archive
```

### Databases

- **Azure SQL Database:**    
    - Fully managed relational database service.
    - Supports SQL Server-based applications.	    
    - **Configuration:**        
        - Databases can be configured with various performance levels, security settings, and backup policies.
        - **Example:** Creating a SQL database:

```
az sql db create --resource-group MyResourceGroup --server myserver --name mydatabase --service-objective S0
```

- **Azure Cosmos DB:**    
    - Fully managed NoSQL database service.
    - Provides global distribution and horizontal scalability.	    
    - **Configuration:**        
        - Cosmos DB can be configured with various consistency levels, throughput, and partitioning options.
        - **Example:** Creating a Cosmos DB account:

```
az cosmosdb create --name mycosmosdb --resource-group MyResourceGroup --kind MongoDB
```

- **Azure Database for PostgreSQL:**    
    - Managed PostgreSQL database service.
    - Provides high availability and automated backups.	    
    - **Configuration:**        
        - Databases can be configured with various compute sizes, storage options, and security settings.
        - **Example:** Creating a PostgreSQL server:

```
az postgres server create --resource-group MyResourceGroup --name mypgserver --location westus --admin-user myadmin --admin-password mypassword --sku-name B_Gen5_1
```

### Networking

- **Azure Virtual Network (VNet):**    
    - Provides isolated virtual networks for deploying Azure resources.
    - Offers control over IP address ranges, subnets, route tables, and network gateways.		
    - **Configuration:**        
        - VNets can be configured with various subnets, security groups, and VPN connections.
        - **Example:** Creating a VNet:

```
az network vnet create --name myVnet --resource-group MyResourceGroup --subnet-name mySubnet
```

- **Azure DNS:**    
    - Provides DNS domain services to manage domain names in Azure.
    - Translates domain names into IP addresses.	    
    - **Configuration:**        
        - DNS zones and records can be configured for name resolution.
        - **Example:** Creating a DNS zone:

```
az network dns zone create --resource-group MyResourceGroup --name example.com
```

- **Azure ExpressRoute:**    
    - Provides dedicated network connections from on-premises to Azure.
    - Offers higher security and reliability than typical internet connections.	    
    - **Configuration:**        
        - ExpressRoute circuits can be configured with various bandwidths and peering options.
        - **Example:** Creating an ExpressRoute circuit:

```
az network express-route create --name MyExpressRoute --resource-group MyResourceGroup --location westus --bandwidth 50 --provider "MyProvider" --peering-location "Silicon Valley"
```

### Security and Identity

- **Azure Active Directory (AAD):**    
    - Provides identity and access management services.
    - Manages users, groups, and application access.	    
    - **Configuration:**        
        - AAD can be configured with various directory roles, conditional access policies, and MFA settings.
        - **Example:** Creating a new user in AAD:

```
az ad user create --display-name "John Doe" --user-principal-name johndoe@mydomain.com --password mypassword
```

- **Azure Key Vault:**    
    - Manages encryption keys, secrets, and certificates.
    - Ensures data is securely encrypted at rest and in transit.	    
    - **Configuration:**        
        - Key Vaults can be configured with access policies and network restrictions.
        - **Example:** Creating a Key Vault:

```
az keyvault create --name myKeyVault --resource-group MyResourceGroup --location westus
```

- **Azure Security Center:**    
    - Provides unified security management and threat protection.
    - Continuously assesses the security of Azure resources.	    
    - **Configuration:**        
        - Security Center can be configured with various policies and recommendations.
        - **Example:** Enabling Security Center on a subscription:

```
az security auto-provisioning-setting update --name default --auto-provisioning on
```

## Azure Example Use Case

### Web Application Hosting

1. **Deployment:**    
    - Deploy the application on Azure VMs or Azure App Service.
    - Use Azure Scale Sets to adjust the number of instances based on demand.
    - **Configuration:**        
        - Define VM configurations, scale sets, and load balancer settings.
        - **Example:** Creating a VM scale set:

```
az vmss create --resource-group MyResourceGroup --name MyScaleSet --image UbuntuLTS --admin-username azureuser --generate-ssh-keys --instance-count 2 --upgrade-policy-mode automatic
```

2. **Storage:**    
    - Store static assets (images, videos) in Azure Blob Storage.
    - Use Azure Disk Storage for persistent block storage attached to VMs.
    - **Configuration:**        
        - Set up Blob storage containers and attach Disk storage to VMs.
        - **Example:** Attaching a managed disk to a VM:

```
az vm disk attach --resource-group MyResourceGroup --vm-name MyVM --name MyManagedDisk
```

3. **Database:**    
    - Use Azure SQL Database for the relational database backend.
    - Optionally, use Cosmos DB for handling high-throughput, low-latency NoSQL database needs.
    - **Configuration:**        
        - Configure SQL Database and Cosmos DB accounts.
        - **Example:** Creating a SQL database:

```
az sql db create --resource-group MyResourceGroup --server myserver --name mydatabase --service-objective S0
```

4. **Networking:**    
    - Set up a VNet to isolate the applicationâ€™s network.
    - Use Azure Load Balancer to distribute traffic across multiple VM instances.
    - **Configuration:**        
        - Configure VNet subnets, network security groups, and load balancer settings.
        - **Example:** Creating an internal load balancer:

```
az network lb create --resource-group MyResourceGroup --name myLoadBalancer --sku Basic --vnet-name myVnet --subnet mySubnet --backend-pool-name myBackEndPool
```

5. **Security:**    
    - Use Azure AD to manage access control and permissions.
    - Implement SSL/TLS for secure data transmission.
    - Use Azure Application Gateway with Web Application Firewall (WAF) to protect against web exploits and attacks.
    - **Configuration:**        
        - Configure AD policies, SSL certificates, and WAF rules.
        - **Example:** Adding an SSL certificate to an App Service:

```
az webapp config ssl bind --resource-group MyResourceGroup --name MyWebApp --certificate-thumbprint <thumbprint> --ssl-type SNI
```

6. **Monitoring and Logging:**    
    - Use Azure Monitor to monitor application performance and resource utilization.
    - Use Azure Log Analytics to collect and analyze logs.
    - **Configuration:**        
        - Set up Monitor alerts, dashboards, and Log Analytics workspaces.
        - **Example:** Creating an alert rule:

```
az monitor metrics alert create --resource-group MyResourceGroup --name HighCPUAlert --scopes <resource-id> --condition "avg Percentage CPU > 80" --window-size 5m --evaluation-frequency 1m --action <action-group-id>
```        

# Additional Information

## Configuration Files

Azure Resource Manager (ARM) Template Example

```
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.Compute/virtualMachines",
      "apiVersion": "2019-03-01",
      "name": "myVM",
      "location": "[resourceGroup().location]",
      "properties": {
        "hardwareProfile": {
          "vmSize": "Standard_DS1_v2"
        },
        "storageProfile": {
          "imageReference": {
            "publisher": "Canonical",
            "offer": "UbuntuServer",
            "sku": "16.04-LTS",
            "version": "latest"
          },
          "osDisk": {
            "createOption": "FromImage"
          }
        },
        "osProfile": {
          "computerName": "myVM",
          "adminUsername": "azureuser",
          "linuxConfiguration": {
            "disablePasswordAuthentication": true,
            "ssh": {
              "publicKeys": [
                {
                  "path": "/home/azureuser/.ssh/authorized_keys",
                  "keyData": "[parameters('sshKey')]"
                }
              ]
            }
          }
        },
        "networkProfile": {
          "networkInterfaces": [
            {
              "id": "[resourceId('Microsoft.Network/networkInterfaces', 'myNic')]"
            }
          ]
        }
      }
    }
  ],
  "parameters": {
    "sshKey": {
      "type": "string",
      "metadata": {
        "description": "SSH public key"
      }
    }
  }
}
```

Network Security Group (NSG) Rule Example

```
{
  "name": "allow-ssh",
  "properties": {
    "description": "Allow SSH access",
    "protocol": "Tcp",
    "sourcePortRange": "*",
    "destinationPortRange": "22",
    "sourceAddressPrefix": "Internet",
    "destinationAddressPrefix": "*",
    "access": "Allow",
    "priority": 1000,
    "direction": "Inbound"
  }
}
```

## Potential Misconfigurations

- **Open Blob Storage Containers:** Publicly accessible Blob containers can lead to data leakage.
- **Overly Permissive AD Policies:** Using broad permissions in Azure AD can grant excessive access.
- **NSGs with Open Ports:** Allowing inbound traffic from any IP address (0.0.0.0/0) can expose resources to attacks.
- **Unrestricted Function App Settings:** Granting broad permissions to Function Apps can lead to privilege escalation.
- **Unencrypted Data:** Failing to encrypt data at rest and in transit can expose sensitive information.

## Default Credentials

- **Azure accounts should never use default credentials:** Always create individual Azure AD users with specific permissions.
- **Rotate Access Keys:** Regularly rotate access keys to minimize the risk of credential leakage.
- **Use Managed Identities:** Assign managed identities to services instead of using long-term access keys.

# Interaction and Tools

## Reconnaissance and Enumeration Tools

- **Azure CLI:** Command-line tool to interact with Azure services.

```
az vm list az storage account list
```

- **Azucar:** An Azure environment enumeration tool designed for red teams.
- **ScoutSuite:** Multi-cloud security-auditing tool for AWS, Azure, and GCP.

```
scoutsuite scan azure --services compute,storage,network
```

## Vulnerability Scanning Tools

- **Nessus:** Vulnerability scanner that can scan Azure environments for common vulnerabilities.
- **Azure Security Center:** Built-in service that provides security recommendations and continuous assessment.

```
az security assessment list
```

## Exploitation Tools

- **Metasploit:** Framework for developing and executing exploit code.
- **Empire:** Post-exploitation framework for maintaining access and conducting lateral movement.
- **PowerZure:** Post-exploitation framework for Azure.

```
Invoke-PowerZure -Command Get-AzurePasswords
```

## Monitoring and Logging Tools

- **Azure Monitor:** Service that collects and analyzes telemetry data.
- **Azure Log Analytics:** Provides insights into the operations and performance of resources.
- **Azure Sentinel:** Cloud-native SIEM solution for threat detection and response.

# Common Exploits

## Compute (VMs)

- **Instance Metadata Service Exploitation:** Exploiting the instance metadata service to retrieve sensitive information.
- **Privilege Escalation:** Exploiting VM extension misconfigurations to escalate privileges.
- **Instance Metadata Service Exploitation**
	- **Exploit:** Accessing sensitive data such as tokens through the metadata service.
	- **Mitigation:** Use role-based access controls and secure configuration settings.

```
curl -H Metadata:true --noproxy "*" "http://169.254.169.254/metadata/instance?api-version=2021-01-01"
```

## Storage (Blob)

- **Container Enumeration and Data Exfiltration:** Identifying and accessing publicly accessible Blob containers.
- **Data Leakage:** Exfiltrating sensitive data from misconfigured containers.
- **Public Blob Container Exposure**
	- **Exploit:** Accessing publicly accessible Blob containers to exfiltrate data.
	- **Mitigation:** Implement strict container policies and access controls.

```
az storage container set-permission --name mycontainer --public-access off --account-name mystorageaccount
```

## Database (SQL Database)

- **SQL Injection:** Exploiting SQL injection vulnerabilities in web applications to access the database.
- **Public Exposure:** Exploiting publicly accessible SQL databases to gain unauthorized access.
- **Public SQL Database Exposure**
	- **Exploit:** Accessing publicly accessible SQL databases to exfiltrate data.
	- **Mitigation:** Use firewall rules and VNet service endpoints to restrict access.

```
az sql server firewall-rule create --resource-group MyResourceGroup --server myserver --name AllowMyIP --start-ip-address <start-ip> --end-ip-address <end-ip>
```

## AD (Azure Active Directory)

- **Credential Leakage:** Exploiting leaked credentials to gain unauthorized access to Azure resources.
- **Role Assumption:** Assuming roles with excessive permissions to escalate privileges.
- **Role Privilege Escalation**
	- **Exploit:** Exploiting weak AD role policies to escalate privileges.
	- **Mitigation:** Regularly review and tighten AD policies, ensuring the principle of least privilege.

```
az role assignment list --assignee <user>
```

## Networking (VNet)

- **Open Ports and Services:** Exploiting open ports and services exposed within the VNet.
- **Network Misconfiguration:** Exploiting misconfigured subnets and routing tables to access restricted resources.
- **VNet Misconfiguration**
	- **Exploit:** Exploiting open NSG rules and misconfigured routing tables to access restricted resources.
	- **Mitigation:** Use strict NSG rules and routing configurations to control traffic.

```
az network nsg rule create --resource-group MyResourceGroup --nsg-name myNSG --name myNSGRule --protocol Tcp --direction Inbound --priority 1000 --source-address-prefix Internet --source-port-range * --destination-address-prefix * --destination-port-range 22 --access Deny
```

## Serverless (Functions)

- **Code Injection:** Injecting malicious code into Azure Functions to execute unauthorized actions.
- **Event Injection:** Triggering Functions with crafted events to exploit vulnerabilities.
- **Function App Misuse**
	- **Exploit:** Exploiting overly permissive Function App settings to perform unauthorized actions.
	- **Mitigation:** Assign minimal permissions required for Functions and use strict access policies.

```
az functionapp config appsettings set --resource-group MyResourceGroup --name MyFunctionApp --settings FUNCTION_LOGGING_LEVEL=Verbose
```