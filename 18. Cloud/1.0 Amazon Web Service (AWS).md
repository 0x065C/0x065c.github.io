# Index
- [[Cloud]]
	- [[1.0 Amazon Web Service (AWS)]]
	- [[2.0 Microsoft Azure]]
	- [[3.0 Google Cloud Services (GCS)]]
	- [[4.0 SalesForce Cloud]]

# Summary
- **Service Name:** Amazon Web Services (AWS)
- **Category:** Cloud Computing Platform
- **Components:** Compute, Storage, Database, Networking, Analytics, Machine Learning, IoT, Security, and more.

## Amazon Web Services Overview
Amazon Web Services (AWS) is a comprehensive and widely adopted cloud platform that offers a range of infrastructure and application services. These services can be accessed over the internet and are provided on a pay-as-you-go basis. AWS helps businesses scale and grow by providing reliable, scalable, and low-cost infrastructure solutions.

AWS is a cloud computing platform that provides a mix of IaaS (Infrastructure as a Service), PaaS (Platform as a Service), and SaaS (Software as a Service). It offers a wide array of global cloud-based products including compute, storage, databases, analytics, networking, mobile, developer tools, management tools, IoT, security, and enterprise applications.

## How AWS Works
AWS operates through a global network of data centers managed by Amazon. These data centers are organized into regions and availability zones (AZs). Each region is a separate geographic area, and each region has multiple isolated locations known as availability zones. This structure provides high availability, fault tolerance, and scalability.

1. **Global Infrastructure:**    
    - **Regions:** Geographic locations around the world where AWS clusters its data centers.
    - **Availability Zones (AZs):** Multiple, isolated locations within each region. They provide redundancy and fault tolerance.
    
2. **Services and Resources:**    
    - **Compute:** Services like Amazon EC2, Lambda, and ECS allow for flexible computing power.
    - **Storage:** Amazon S3, EBS, and Glacier provide various storage solutions for different needs.
    - **Databases:** Managed database services like RDS, DynamoDB, and Redshift.
    - **Networking:** VPC, Route 53, and Direct Connect offer robust networking capabilities.
    - **Developer Tools:** Services like CodeCommit, CodeBuild, CodeDeploy, and CodePipeline support the software development lifecycle.
    - **Security and Identity:** IAM, KMS, and AWS Shield provide security and identity management.

## Key AWS Services

### Compute

- **Amazon EC2 (Elastic Compute Cloud):**    
    - Provides scalable virtual servers.
    - Instances can be launched, resized, and terminated as needed.
    - Supports a wide range of instance types optimized for different tasks.	    
    - **Configuration:**        
        - EC2 instances can be configured with various instance types, AMIs (Amazon Machine Images), storage options (EBS, instance store), security groups, and IAM roles.
        - **Example:** Launching an EC2 instance with a specific AMI and security group:

```
aws ec2 run-instances --image-id <ami-id> --count 1 --instance-type t2.micro --key-name MyKeyPair --security-group-ids <sg-id> --subnet-id <subnet-id>
```

- **AWS Lambda:**    
    - A serverless compute service that runs code in response to events.
    - Automatically manages the compute resources.
    - Ideal for event-driven applications and microservices.	    
    - **Configuration:**        
        - Lambda functions can be configured with memory size, timeout settings, and IAM roles.
        - **Example:** Creating a Lambda function using AWS CLI:

```
aws lambda create-function --function-name MyFunction --runtime python3.8 --role <role-arn> --handler lambda_function.lambda_handler --zip-file fileb://function.zip
```

- **Amazon ECS (Elastic Container Service):**    
    - A fully managed container orchestration service.
    - Supports Docker containers and allows for scalable deployment of containerized applications.	    
    - **Configuration:**
        - ECS tasks and services can be configured with task definitions, IAM roles, and networking settings.
        - **Example:** Registering a task definition:

```
{
  "family": "my-task",
  "containerDefinitions": [
    {
      "name": "my-container",
      "image": "nginx",
      "memory": 512,
      "cpu": 256,
      "essential": true
    }
  ]
}
```
### Storage

- **Amazon S3 (Simple Storage Service):**    
    - Object storage service that offers scalability, data availability, security, and performance.
    - Stores data as objects within buckets.
    - Ideal for backup, archiving, and big data analytics.	    
    - **Configuration:**        
        - S3 buckets can be configured with versioning, logging, and bucket policies.
        - **Example:** Creating a bucket with versioning enabled:

```
aws s3api create-bucket --bucket my-bucket --region us-west-2
aws s3api put-bucket-versioning --bucket my-bucket --versioning-configuration Status=Enabled
```

- **Amazon EBS (Elastic Block Store):**    
    - Provides persistent block storage volumes for use with Amazon EC2.
    - Volumes can be dynamically attached to instances and support high throughput and low latency.	    
    - **Configuration:**        
        - EBS volumes can be configured with encryption, snapshot settings, and volume types.
        - **Example:** Creating an encrypted EBS volume:

```
aws ec2 create-volume --size 10 --region us-west-2 --availability-zone us-west-2a --volume-type gp2 --encrypted
```

- **Amazon Glacier:**    
    - Low-cost storage service for data archiving and long-term backup.
    - Provides secure and durable storage for infrequently accessed data.		
    - **Configuration:**        
        - Glacier vaults can be configured with policies for data retrieval and access.
        - **Example:** Creating a Glacier vault:

```
aws glacier create-vault --vault-name my-vault --account-id -
```

### Databases

- **Amazon RDS (Relational Database Service):**    
    - Managed relational database service supporting various database engines (MySQL, PostgreSQL, Oracle, SQL Server).
    - Automates common administrative tasks such as backups, patching, and scaling.
    - **Configuration:**        
        - RDS instances can be configured with database engine, instance class, storage type, and security settings.
        - **Example:** Creating an RDS instance with MySQL:

```
aws rds create-db-instance --db-instance-identifier mydbinstance --db-instance-class db.t2.micro --engine mysql --master-username admin --master-user-password password --allocated-storage 20
```
   
- **Amazon DynamoDB:**    
    - Fully managed NoSQL database service.
    - Provides fast and predictable performance with seamless scalability.
    - Ideal for applications requiring consistent, single-digit millisecond latency.
    - **Configuration:**        
        - DynamoDB tables can be configured with primary key schema, provisioned throughput, and indexes.
        - **Example:** Creating a DynamoDB table:

```
aws dynamodb create-table --table-name MyTable --attribute-definitions AttributeName=Id,AttributeType=N --key-schema AttributeName=Id,KeyType=HASH --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5
```
 
- **Amazon Redshift:**    
    - Fully managed data warehouse service.
    - Allows for fast querying and analysis of large datasets.
    - Integrates with business intelligence tools for data visualization.
    - **Configuration:**        
        - Redshift clusters can be configured with node type, number of nodes, and security settings.
        - **Example:** Creating a Redshift cluster:

```
aws redshift create-cluster --cluster-identifier my-cluster --node-type dc2.large --mas
```

### Networking

- **Amazon VPC (Virtual Private Cloud):**    
    - Provides isolated virtual networks for deploying AWS resources.
    - Offers control over IP address ranges, subnets, route tables, and network gateways.
    - **Configuration:**        
        - VPCs can be configured with CIDR blocks, subnets, route tables, and security groups.
        - **Example:** Creating a VPC with subnets:

```
aws ec2 create-vpc --cidr-block 10.0.0.0/16 aws ec2 create-subnet --vpc-id <vpc-id> --cidr-block 10.0.1.0/24
```

- **Amazon Route 53:**    
    - Scalable DNS web service.
    - Translates domain names into IP addresses.
    - Provides domain registration, DNS routing, and health checking.
    - **Configuration:**        
        - Route 53 can be configured with hosted zones, DNS records, and health checks.
        - **Example:** Creating a hosted zone and DNS record:

```
aws route53 create-hosted-zone --name example.com --caller-reference <unique-string> aws route53 change-resource-record-sets --hosted-zone-id <zone-id> --change-batch file://change-batch.json
```

- **AWS Direct Connect:**    
    - Dedicated network connection from on-premises to AWS.
    - Reduces network costs, increases bandwidth throughput, and provides a more consistent network experience.
    - **Configuration:**        
        - Direct Connect connections can be configured with virtual interfaces, BGP settings, and connection speeds.
        - **Example:** Creating a Direct Connect connection:

```
aws directconnect create-connection --location EqSe2 --bandwidth 1Gbps --connection-name MyCo
```

### Security and Identity

- **AWS IAM (Identity and Access Management):**    
    - Controls access to AWS services and resources.
    - Manages users, groups, roles, and permissions.
    - Supports multi-factor authentication (MFA) and secure access control.
    - **Configuration:**        
        - IAM policies, roles, users, and groups can be configured to manage access controls.
        - **Example:** Creating an IAM user with policy:

```
aws iam create-user --user-name my-user aws iam attach-user-policy --user-name my-user --policy-arn arn:aws:iam::aws:policy/AdministratorAccess
```

- **AWS KMS (Key Management Service):**    
    - Managed service for creating and controlling encryption keys.
    - Ensures data is securely encrypted at rest and in transit.
    - **Configuration:**        
        - KMS keys can be configured with key policies and aliases.
        - **Example:** Creating a KMS key:

```
aws kms create-key --description "My KMS Key" aws kms create-alias --alias-name alias/my-key --target-key-id <key-id>
```

- **AWS Shield:**    
    - Managed DDoS protection service.
    - Protects applications running on AWS against DDoS attacks.
    - **Configuration:**        
        - AWS Shield can be enabled with protection for specific resources.
        - **Example:** Enabling AWS Shield Advanced for a resource:

```
aws shield create-protection --name MyProtection --resource-arn <resource-arn>
```

## AWS Example Use Case

### Web Application Hosting

1. **Deployment:**    
    - Deploy the application on Amazon EC2 instances.
    - Use Auto Scaling to adjust the number of instances based on demand.
    - **Configuration:**        
        - Define launch configurations, auto-scaling groups, and scaling policies.
        - **Example:** Creating an auto-scaling group:

```
aws autoscaling create-auto-scaling-group --auto-scaling-group-name my-asg --launch-configuration-name my-launch-config --min-size 1 --max-size 5 --desired-capacity 2 --vpc-zone-identifier <subnet-id>
```

2. **Storage:**    
    - Store static assets (images, videos) in Amazon S3.
    - Use Amazon EBS for persistent block storage attached to EC2 instances.
    - **Configuration:**        
        - Set up S3 bucket policies and EBS volume attachment.
        - **Example:** Attaching an EBS volume to an instance:

```
aws ec2 attach-volume --volume-id <volume-id> --instance-id <instance-id> --device /dev/sdh
```

3. **Database:**    
    - Use Amazon RDS for the relational database backend.
    - Optionally, use Amazon DynamoDB for handling high-throughput, low-latency NoSQL database needs.
    - **Configuration:**        
        - Configure RDS instances and DynamoDB tables.
        - **Example:** Setting up an RDS MySQL database:

```
aws rds create-db-instance --db-instance-identifier mydbinstance --db-instance-class db.t2.micro --engine mysql --master-username admin --master-user-password password --allocated-storage 20
```

4. **Networking:**    
    - Set up a VPC to isolate the application’s network.
    - Use Elastic Load Balancing (ELB) to distribute traffic across multiple EC2 instances.
    - **Configuration:**        
        - Configure VPC subnets, security groups, and ELB settings.
        - **Example:** Creating an application load balancer:

```
aws elbv2 create-load-balancer --name my-load-balancer --subnets <subnet-ids> --security-groups <sg-ids>
```

5. **Security:**    
    - Use IAM to manage access control and permissions.
    - Implement SSL/TLS for secure data transmission.
    - Use AWS WAF (Web Application Firewall) to protect against web exploits and attacks.
    - **Configuration:**        
        - Configure IAM policies, SSL certificates, and WAF rules.
        - **Example:** Creating an SSL certificate using ACM:

```
aws acm request-certificate --domain-name example.com --validation-method DNS
```

6. **Monitoring and Logging:**    
    - Use Amazon CloudWatch to monitor application performance and resource utilization.
    - Use AWS CloudTrail to log and audit API calls.
    - **Configuration:**        
        - Set up CloudWatch alarms, dashboards, and CloudTrail trails.
        - **Example:** Creating a CloudWatch alarm:

```
aws cloudwatch put-metric-alarm --alarm-name cpu-alarm --metric-name CPUUtilization --na
```

# Addition Information

## Configuration Files

IAM Policy Example

```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:Describe*",
        "s3:List*"
      ],
      "Resource": "*"
    },
    {
      "Effect": "Deny",
      "Action": [
        "iam:*"
      ],
      "Resource": "*"
    }
  ]
}
```

Security Group Example

```
{
  "Description": "Allow SSH and HTTP access",
  "SecurityGroupRules": [
    {
      "IpProtocol": "tcp",
      "FromPort": 22,
      "ToPort": 22,
      "CidrIp": "0.0.0.0/0"
    },
    {
      "IpProtocol": "tcp",
      "FromPort": 80,
      "ToPort": 80,
      "CidrIp": "0.0.0.0/0"
    }
  ]
}
```

## Potential Misconfigurations

- **Open S3 Buckets:** Publicly accessible S3 buckets can lead to data leakage.
- **Overly Permissive IAM Policies:** Using wildcards (*) in IAM policies can grant excessive permissions.
- **Security Groups with Open Ports:** Allowing inbound traffic from any IP address (0.0.0.0/0) can expose resources to attacks.
- **Unrestricted Lambda Execution Roles:** Granting broad permissions to Lambda execution roles can lead to privilege escalation.
- **Unencrypted Data:** Failing to encrypt data at rest and in transit can expose sensitive information.

## Default Credentials

- **AWS accounts should never use default credentials:** Always create individual IAM users with specific permissions.
- **Rotate Access Keys:** Regularly rotate access keys to minimize the risk of credential leakage.
- **Use IAM Roles:** Assign roles to services instead of using long-term access keys.

# Interaction and Tools

## Reconnaissance and Enumeration Tools

- **AWS CLI:** Command-line tool to interact with AWS services.

```
aws ec2 describe-instances aws s3 ls
```


- **PacBot:** Open-source cloud security, governance, and compliance tool.
- **ScoutSuite:** Multi-cloud security-auditing tool for AWS, Azure, and GCP.
   
```
scoutsuite scan aws --services ec2,s3,iam
```

## Vulnerability Scanning Tools

- **Nessus:** Vulnerability scanner that can scan AWS environments for common vulnerabilities.
- **Prowler:** AWS security best practices assessment tool.

```
prowler -M csv > prowler-report.csv
```

## Exploitation Tools

- **Metasploit:** Framework for developing and executing exploit code.
- **Empire:** Post-exploitation framework for maintaining access and conducting lateral movement.
- **AWS Exploitation Framework (Pacu):** Tool designed to facilitate penetration testing in AWS environments.

```
pacu --profile default
```
  
## Monitoring and Logging Tools

- **CloudTrail:** AWS service that logs API calls.
- **CloudWatch:** Monitoring and observability service for AWS resources.
- **GuardDuty:** Threat detection service that continuously monitors for malicious activity.

# Common Exploits

## Compute (EC2)

- **Instance Metadata Service (IMDS) Exploitation:**    
    - **Objective:** Gain access to metadata service to retrieve sensitive data such as IAM role credentials.
    - **Method:** Using tools like curl to access the metadata service.
    - **Example:**

```
curl http://169.254.169.254/latest/meta-data/ curl http://169.254.169.254/latest/meta-data/iam/security-credentials/
```
- **Mitigation:** Use IMDSv2 which requires session tokens.

```
curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"
```
 
- **Privilege Escalation via IAM Role Misconfigurations:**    
    - **Objective:** Escalate privileges by exploiting overly permissive IAM roles.
    - **Method:** Identify IAM roles with excessive permissions and use them to gain higher privileges.
    - **Example:** Listing IAM roles and their policies.

```
aws iam list-roles
aws iam get-role --role-name <role-name>
```

- **EC2 Instance Metadata Service Exploitation**
	- **Exploit:** Accessing sensitive data such as IAM role credentials through the metadata service.
	- **Mitigation:** Use IMDSv2, which requires session tokens for accessing the metadata service.

```
curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"
```

## Storage (S3)

- **Bucket Enumeration and Data Exfiltration:**    
    - **Objective:** Identify publicly accessible S3 buckets and exfiltrate data.
    - **Method:** Using tools like AWS CLI and automated scripts.
    - **Example:**

```
aws s3 ls aws s3 cp s3://public-bucket/file.txt .
```
   
   - **Mitigation:** Implement strict bucket policies and access controls.

```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": "arn:aws:s3:::example-bucket/*",
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "false"
        }
      }
    }
  ]
}
```

- **Public S3 Bucket Exposure**
	- **Exploit:** Accessing publicly accessible S3 buckets to exfiltrate data.
	- **Mitigation:** Use bucket policies and access controls to restrict access.

```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": "arn:aws:s3:::example-bucket/*",
      "Condition": {
        "Bool": {
          "aws:SecureTransport": "false"
        }
      }
    }
  ]
}
```

## Database (RDS)

- 1. **SQL Injection:**    
    - **Objective:** Exploit SQL injection vulnerabilities in web applications to access the database.
    - **Method:** Identifying vulnerable input fields and injecting SQL commands.
    - **Example:** Exploiting a login form.

```
' OR 1=1; --
```

- **Publicly Accessible RDS Instances:**    
    - **Objective:** Gain unauthorized access to publicly accessible RDS instances.
    - **Method:** Scanning for open RDS endpoints and attempting to connect.
    - **Example:** Using nmap to scan for open ports.

```
nmap -p 3306 <target_ip>
```

   - **Mitigation:** Restrict access to RDS instances using security groups and VPC settings.

## IAM

- **Credential Leakage:**    
    - **Objective:** Exploit leaked credentials to gain unauthorized access to AWS resources.
    - **Method:** Searching for credentials in source code, configuration files, and public repositories.
    - **Example:** Using git-secrets to scan for AWS keys.

```
git-secrets --scan
```
  
   - **Mitigation:** Regularly rotate credentials, use IAM roles, and avoid hardcoding credentials.
   
- **Role Assumption with Excessive Permissions:**    
    - **Objective:** Assume IAM roles with excessive permissions to escalate privileges.
    - **Method:** Identifying roles that can be assumed and using them to gain higher privileges.
    - **Example:** Assuming a role using AWS CLI.

```
aws sts assume-role --role-arn <role-arn> --role-session-name "RoleSession"
```

- **Mitigation:** Regularly review and tighten IAM policies, and implement the principle of least privilege.

- **IAM Role Privilege Escalation**
	- **Exploit:** Exploiting weak IAM role policies to escalate privileges.
	- **Mitigation:** Regularly review and tighten IAM policies, ensuring the principle of least privilege.

```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:ListBucket",
      "Resource": "arn:aws:s3:::example-bucket"
    },
    {
      "Effect": "Deny",
      "Action": [
        "iam:CreateUser",
        "iam:AttachUserPolicy"
      ],
      "Resource": "*"
    }
  ]
}
```


## Networking (VPC)

- **Open Ports and Services:**    
    - **Objective:** Exploit open ports and services exposed within the VPC.
    - **Method:** Using port scanning tools to identify open ports and services.
    - **Example:** Using nmap to scan for open ports.

```
nmap -p 22,80,443 <target_ip>
```

   - **Mitigation:** Implement strict security group rules and NACLs to control traffic.
   
- **Network Misconfigurations:**    
    - **Objective:** Exploit misconfigured subnets and routing tables to access restricted resources.
    - **Method:** Analyzing VPC configurations and attempting to route traffic to sensitive resources.
    - **Example:** Using AWS CLI to describe VPC settings.

```
aws ec2 describe-vpcs aws ec2 describe-route-tables
```

   - **Mitigation:** Regularly review and secure VPC configurations, and restrict routing rules.

- **VPC Misconfiguration**
	- **Exploit:** Exploiting open security groups and misconfigured network ACLs to access restricted resources.
	- **Mitigation:** Use strict security group rules and NACLs to control traffic.

```
{
  "SecurityGroups": [
    {
      "Description": "Allow SSH from corporate network",
      "IpPermissions": [
        {
          "IpProtocol": "tcp",
          "FromPort": 22,
          "ToPort": 22,
          "IpRanges": [
            {
              "CidrIp": "203.0.113.0/24",
              "Description": "Corporate network"
            }
          ]
        }
      ]
    }
  ]
}
```

## Serverless (Lambda)

- **Code Injection:**    
    - **Objective:** Inject malicious code into Lambda functions to execute unauthorized actions.
    - **Method:** Identifying vulnerable Lambda functions and injecting code.
    - **Example:** Modifying a Lambda function's code.

```
aws lambda update-function-code --function-name MyFunction --zip-file fileb://function.zip
```

- **Event Injection:**    
    - **Objective:** Triggering Lambda functions with crafted events to exploit vulnerabilities.
    - **Method:** Creating malicious events to trigger Lambda functions.
    - **Example:** Using AWS CLI to invoke a Lambda function.

```
aws lambda invoke --function-name MyFunction --payload '{"key":"value"}' output.json
```

   - **Mitigation:** Validate input events and implement strict permission policies.
   
- **Lambda Function Misuse**
	- **Exploit:** Exploiting overly permissive Lambda execution roles to perform unauthorized actions.
	- **Mitigation:** Assign minimal permissions required for Lambda functions and use IAM conditions to restrict actions.

```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "dynamodb:GetItem",
        "dynamodb:PutItem"
      ],
      "Resource": "arn:aws:dynamodb:us-west-2:123456789012:table/ExampleTable"
    }
  ]
}
```